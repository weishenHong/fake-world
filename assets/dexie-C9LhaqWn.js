import"./react-BAo46_27.js";const Te=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Ke=Object.keys,Le=Array.isArray;function Ve(t,e){return typeof e!="object"||Ke(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||Te.Promise||(Te.Promise=Promise);const sn=Object.getPrototypeOf,Fi={}.hasOwnProperty;function et(t,e){return Fi.call(t,e)}function Gt(t,e){typeof e=="function"&&(e=e(sn(t))),(typeof Reflect>"u"?Ke:Reflect.ownKeys)(e).forEach(n=>{wt(t,n,e[n])})}const ei=Object.defineProperty;function wt(t,e,n,r){ei(t,e,Ve(n&&et(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Vt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),wt(t.prototype,"constructor",t),{extend:Gt.bind(null,t.prototype)}}}}const Ui=Object.getOwnPropertyDescriptor;function xr(t,e){let n;return Ui(t,e)||(n=sn(t))&&xr(n,e)}const Li=[].slice;function In(t,e,n){return Li.call(t,e,n)}function ti(t,e){return e(t)}function Xt(t){if(!t)throw new Error("Assertion Failed")}function ni(t){Te.setImmediate?setImmediate(t):setTimeout(t,0)}function ri(t,e){return t.reduce((n,r,i)=>{var s=e(r,i);return s&&(n[s[0]]=s[1]),n},{})}function _t(t,e){if(typeof e=="string"&&et(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var s=_t(t,e[r]);n.push(s)}return n}var o=e.indexOf(".");if(o!==-1){var h=t[e.substr(0,o)];return h===void 0?void 0:_t(h,e.substr(o+1))}}function ft(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Xt(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)ft(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var o=e.substr(0,s),h=e.substr(s+1);if(h==="")n===void 0?Le(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var d=t[o];d&&et(t,o)||(d=t[o]={}),ft(d,h,n)}}else n===void 0?Le(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function ii(t){var e={};for(var n in t)et(t,n)&&(e[n]=t[n]);return e}const Mi=[].concat;function oi(t){return Mi.apply([],t)}const si="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(oi([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>Te[t]),$i=si.map(t=>Te[t]);ri(si,t=>[t,!0]);let At=null;function dn(t){At=typeof WeakMap<"u"&&new WeakMap;const e=tr(t);return At=null,e}function tr(t){if(!t||typeof t!="object")return t;let e=At&&At.get(t);if(e)return e;if(Le(t)){e=[],At&&At.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(tr(t[n]))}else if($i.indexOf(t.constructor)>=0)e=t;else{const s=sn(t);for(var i in e=s===Object.prototype?{}:Object.create(s),At&&At.set(t,e),t)et(t,i)&&(e[i]=tr(t[i]))}return e}const{toString:qi}={};function nr(t){return qi.call(t).slice(8,-1)}const rr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Vi=typeof rr=="symbol"?function(t){var e;return t!=null&&(e=t[rr])&&e.apply(t)}:function(){return null},$t={};function gt(t){var e,n,r,i;if(arguments.length===1){if(Le(t))return t.slice();if(this===$t&&typeof t=="string")return[t];if(i=Vi(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const Pr=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var dt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ai(t,e){dt=t,ui=e}var ui=()=>!0;const Ji=!new Error("").stack;function Ft(){if(Ji)try{throw Ft.arguments,new Error}catch(t){return t}return new Error}function ir(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(ui).map(r=>`
`+r).join("")):""}var ci=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Nr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ci),Yi={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Jt(t,e){this._e=Ft(),this.name=t,this.message=e}function li(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,i)=>i.indexOf(n)===r).join(`
`)}function Bn(t,e,n,r){this._e=Ft(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=li(t,e)}function en(t,e){this._e=Ft(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=li(t,e)}Vt(Jt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ir(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Vt(Bn).from(Jt),Vt(en).from(Jt);var Cr=Nr.reduce((t,e)=>(t[e]=e+"Error",t),{});const Gi=Jt;var te=Nr.reduce((t,e)=>{var n=e+"Error";function r(i,s){this._e=Ft(),this.name=n,i?typeof i=="string"?(this.message=`${i}${s?`
 `+s:""}`,this.inner=s||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=Yi[e]||n,this.inner=null)}return Vt(r).from(Gi),t[e]=r,t},{});te.Syntax=SyntaxError,te.Type=TypeError,te.Range=RangeError;var Mr=ci.reduce((t,e)=>(t[e+"Error"]=te[e],t),{}),Tn=Nr.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=te[e]),t),{});function _e(){}function an(t){return t}function zi(t,e){return t==null||t===an?e:function(n){return e(t(n))}}function Rt(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Wi(t,e){return t===_e?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Rt(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Rt(i,this.onerror):i),s!==void 0?s:n}}function Hi(t,e){return t===_e?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Rt(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Rt(r,this.onerror):r)}}function Xi(t,e){return t===_e?e:function(n){var r=t.apply(this,arguments);Ve(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Rt(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Rt(s,this.onerror):s),r===void 0?o===void 0?void 0:o:Ve(r,o)}}function Qi(t,e){return t===_e?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function jr(t,e){return t===_e?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}Tn.ModifyError=Bn,Tn.DexieError=Jt,Tn.BulkError=en;var un={};const fi=100,[or,Kn,sr]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,sn(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,sn(e),t]})(),hi=Kn&&Kn.then,kn=or&&or.constructor,Ir=!!sr;var ar=!1,Zi=sr?()=>{sr.then(gn)}:Te.setImmediate?setImmediate.bind(null,gn):Te.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{gn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(gn,0)},tn=function(t,e){Qt.push([t,e]),Rn&&(Zi(),Rn=!1)},ur=!0,Rn=!0,Bt=[],xn=[],cr=null,lr=an,Yt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Vr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Vr(t[0],t[1])}catch{}})}},W=Yt,Qt=[],Kt=0,Pn=[];function $(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=_e,this._lib=!1;var e=this._PSD=W;if(dt&&(this._stackHolder=Ft(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==un)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&hr(this,this._value))}this._state=null,this._value=null,++e.ref,pi(this,t)}const fr={get:function(){var t=W,e=Dn;function n(r,i){var s=!t.global&&(t!==W||e!==Dn);const o=s&&!Ot();var h=new $((d,l)=>{Br(this,new di(Fn(r,t,s,o),Fn(i,t,s,o),d,l,t))});return dt&&mi(h,this),h}return n.prototype=un,n},set:function(t){wt(this,"then",t&&t.prototype===un?fr:{get:function(){return t},set:fr.set})}};function di(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}function pi(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&pn();n&&typeof n.then=="function"?pi(t,(i,s)=>{n instanceof $?n._then(i,s):n.then(i,s)}):(t._state=!0,t._value=n,yi(t)),r&&yn()}},hr.bind(null,t))}catch(n){hr(t,n)}}function hr(t,e){if(xn.push(e),t._state===null){var n=t._lib&&pn();e=lr(e),t._state=!1,t._value=e,dt&&e!==null&&typeof e=="object"&&!e._promise&&function(r,i,s){try{r.apply(null,s)}catch(o){i&&i(o)}}(()=>{var r=xr(e,"stack");e._promise=t,wt(e,"stack",{get:()=>ar?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){Bt.some(i=>i._value===r._value)||Bt.push(r)}(t),yi(t),n&&yn()}}function yi(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Br(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),Kt===0&&(++Kt,tn(()=>{--Kt==0&&Kr()},[]))}function Br(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Kt,tn(eo,[n,t,e])}else t._listeners.push(e)}function eo(t,e,n){try{cr=e;var r,i=e._value;e._state?r=t(i):(xn.length&&(xn=[]),r=t(i),xn.indexOf(i)===-1&&function(s){for(var o=Bt.length;o;)if(Bt[--o]._value===s._value)return void Bt.splice(o,1)}(e)),n.resolve(r)}catch(s){n.reject(s)}finally{cr=null,--Kt==0&&Kr(),--n.psd.ref||n.psd.finalize()}}function vi(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i,s,o=t._value;o!=null?(i=o.name||"Error",s=o.message||o,r=ir(o,0)):(i=o,s=""),e.push(i+(s?": "+s:"")+r)}return dt&&((r=ir(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&vi(t._prev,e,n)),e}function mi(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function gn(){pn()&&yn()}function pn(){var t=ur;return ur=!1,Rn=!1,t}function yn(){var t,e,n;do for(;Qt.length>0;)for(t=Qt,Qt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Qt.length>0);ur=!0,Rn=!0}function Kr(){var t=Bt;Bt=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Pn.slice(0),n=e.length;n;)e[--n]()}function bn(t){return new $(un,!1,t)}function ke(t,e){var n=W;return function(){var r=pn(),i=W;try{return xt(n,!0),t.apply(this,arguments)}catch(s){e&&e(s)}finally{xt(i,!1),r&&yn()}}}Gt($.prototype,{then:fr,_then:function(t,e){Br(this,new di(null,null,t,e,W))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):bn(r)):this.then(null,r=>r&&r.name===e?n(r):bn(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),bn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{ar=!0;var t=vi(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{ar=!1}}},timeout:function(t,e){return t<1/0?new $((n,r)=>{var i=setTimeout(()=>r(new te.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&wt($.prototype,Symbol.toStringTag,"Dexie.Promise"),Yt.env=gi(),Gt($,{all:function(){var t=gt.apply(null,arguments).map(wn);return new $(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((i,s)=>$.resolve(i).then(o=>{t[s]=o,--r||e(t)},n))})},resolve:t=>{if(t instanceof $)return t;if(t&&typeof t.then=="function")return new $((n,r)=>{t.then(n,r)});var e=new $(un,!0,t);return mi(e,cr),e},reject:bn,race:function(){var t=gt.apply(null,arguments).map(wn);return new $((e,n)=>{t.map(r=>$.resolve(r).then(e,n))})},PSD:{get:()=>W,set:t=>W=t},totalEchoes:{get:()=>Dn},newPSD:kt,usePSD:Wt,scheduler:{get:()=>tn,set:t=>{tn=t}},rejectionMapper:{get:()=>lr,set:t=>{lr=t}},follow:(t,e)=>new $((n,r)=>kt((i,s)=>{var o=W;o.unhandleds=[],o.onunhandled=s,o.finalize=Rt(function(){(function(h){function d(){h(),Pn.splice(Pn.indexOf(d),1)}Pn.push(d),++Kt,tn(()=>{--Kt==0&&Kr()},[])})(()=>{this.unhandleds.length===0?i():s(this.unhandleds[0])})},o.finalize),t()},e,n,r))}),kn&&(kn.allSettled&&wt($,"allSettled",function(){const t=gt.apply(null,arguments).map(wn);return new $(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((i,s)=>$.resolve(i).then(o=>r[s]={status:"fulfilled",value:o},o=>r[s]={status:"rejected",reason:o}).then(()=>--n||e(r)))})}),kn.any&&typeof AggregateError<"u"&&wt($,"any",function(){const t=gt.apply(null,arguments).map(wn);return new $((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const i=new Array(r);t.forEach((s,o)=>$.resolve(s).then(h=>e(h),h=>{i[o]=h,--r||n(new AggregateError(i))}))})}));const Ue={awaits:0,echoes:0,id:0};var to=0,Nn=[],Gn=0,Dn=0,no=0;function kt(t,e,n,r){var i=W,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++no;var o=Yt.env;s.env=Ir?{Promise:$,PromiseProp:{value:$,configurable:!0,writable:!0},all:$.all,race:$.race,allSettled:$.allSettled,any:$.any,resolve:$.resolve,reject:$.reject,nthen:$r(o.nthen,s),gthen:$r(o.gthen,s)}:{},e&&Ve(s,e),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var h=Wt(s,t,n,r);return s.ref===0&&s.finalize(),h}function zt(){return Ue.id||(Ue.id=++to),++Ue.awaits,Ue.echoes+=fi,Ue.id}function Ot(){return!!Ue.awaits&&(--Ue.awaits==0&&(Ue.id=0),Ue.echoes=Ue.awaits*fi,!0)}function wn(t){return Ue.echoes&&t&&t.constructor===kn?(zt(),t.then(e=>(Ot(),e),e=>(Ot(),Re(e)))):t}function ro(t){++Dn,Ue.echoes&&--Ue.echoes!=0||(Ue.echoes=Ue.id=0),Nn.push(W),xt(t,!0)}function io(){var t=Nn[Nn.length-1];Nn.pop(),xt(t,!1)}function xt(t,e){var n=W;if((e?!Ue.echoes||Gn++&&t===W:!Gn||--Gn&&t===W)||bi(e?ro.bind(null,t):io),t!==W&&(W=t,n===Yt&&(Yt.env=gi()),Ir)){var r=Yt.env.Promise,i=t.env;Kn.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(Te,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function gi(){var t=Te.Promise;return Ir?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(Te,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Kn.then,gthen:t.prototype.then}:{}}function Wt(t,e,n,r,i){var s=W;try{return xt(t,!0),e(n,r,i)}finally{xt(s,!1)}}function bi(t){hi.call(or,t)}function Fn(t,e,n,r){return typeof t!="function"?t:function(){var i=W;n&&zt(),xt(e,!0);try{return t.apply(this,arguments)}finally{xt(i,!1),r&&bi(Ot)}}}function $r(t,e){return function(n,r){return t.call(this,Fn(n,e),Fn(r,e))}}(""+hi).indexOf("[native code]")===-1&&(zt=Ot=_e);const qr="unhandledrejection";function Vr(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(Te.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(qr,!0,!0),Ve(r,i)):Te.CustomEvent&&Ve(r=new CustomEvent(qr,{detail:i}),i),r&&Te.dispatchEvent&&(dispatchEvent(r),!Te.PromiseRejectionEvent&&Te.onunhandledrejection))try{Te.onunhandledrejection(r)}catch{}dt&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var Re=$.reject;function dr(t,e,n,r){if(t.idbdb&&(t._state.openComplete||W.letThrough||t._vip)){var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(s){return s.name===Cr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>dr(t,e,n,r))):Re(s)}return i._promise(e,(s,o)=>kt(()=>(W.trans=i,r(s,o,i)))).then(s=>i._completion.then(()=>s))}if(t._state.openComplete)return Re(new te.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Re(new te.DatabaseClosed);t.open().catch(_e)}return t._state.dbReadyPromise.then(()=>dr(t,e,n,r))}const Jr="3.2.5",It="￿",pr=-1/0,vt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",wi="String expected.",nn=[],$n=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),oo=$n,so=$n,_i=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),qn="__dbnames",zn="readonly",Wn="readwrite";function Dt(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Oi={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function _n(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=dn(e))[t],e)}class ao{_trans(e,n,r){const i=this._tx||W.trans,s=this.name;function o(d,l,p){if(!p.schema[s])throw new te.NotFound("Table "+s+" not part of transaction");return n(p.idbtrans,p)}const h=pn();try{return i&&i.db===this.db?i===W.trans?i._promise(e,o,r):kt(()=>i._promise(e,o,r),{trans:i,transless:W.transless||W}):dr(this.db,e,[this.name],o)}finally{h&&yn()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(i=>this.hook.reading.fire(i))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Le(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=Ke(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(l=>{if(l.compound&&n.every(p=>l.keyPath.indexOf(p)>=0)){for(let p=0;p<n.length;++p)if(n.indexOf(l.keyPath[p])===-1)return!1;return!0}return!1}).sort((l,p)=>l.keyPath.length-p.keyPath.length)[0];if(r&&this.db._maxKey!==It){const l=r.keyPath.slice(0,n.length);return this.where(l).equals(l.map(p=>e[p]))}!r&&dt&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:i}=this.schema,s=this.db._deps.indexedDB;function o(l,p){try{return s.cmp(l,p)===0}catch{return!1}}const[h,d]=n.reduce(([l,p],m)=>{const g=i[m],O=e[m];return[l||g,l||!g?Dt(p,g&&g.multi?T=>{const w=_t(T,m);return Le(w)&&w.some(x=>o(O,x))}:T=>o(O,_t(T,m))):p]},[null,null]);return h?this.where(h.name).equals(e[h.keyPath]).filter(d):r?this.filter(d):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Le(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const i=Object.create(e.prototype);for(var s in r)if(et(r,s))try{i[s]=r[s]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){Ve(this,e)})}add(e,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=_n(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[s]})).then(o=>o.numFailures?$.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{ft(e,i,o)}catch{}return o})}update(e,n){if(typeof e!="object"||Le(e))return this.where(":id").equals(e).modify(n);{const r=_t(e,this.schema.primKey.keyPath);if(r===void 0)return Re(new te.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?Ke(n).forEach(i=>{ft(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:i}=this.schema.primKey;let s=e;return i&&r&&(s=_n(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[s],keys:n!=null?[n]:null})).then(o=>o.numFailures?$.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{ft(e,i,o)}catch{}return o})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?$.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Oi})).then(e=>e.numFailures?$.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:h,keyPath:d}=this.schema.primKey;if(d&&i)throw new te.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const l=e.length;let p=d&&h?e.map(_n(d)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:p,wantResults:s}).then(({numFailures:m,results:g,lastResult:O,failures:T})=>{if(m===0)return s?g:O;throw new en(`${this.name}.bulkAdd(): ${m} of ${l} operations failed`,T)})})}bulkPut(e,n,r){const i=Array.isArray(n)?n:void 0,s=(r=r||(i?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:h,keyPath:d}=this.schema.primKey;if(d&&i)throw new te.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new te.InvalidArgument("Arguments objects and keys must have the same length");const l=e.length;let p=d&&h?e.map(_n(d)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:p,wantResults:s}).then(({numFailures:m,results:g,lastResult:O,failures:T})=>{if(m===0)return s?g:O;throw new en(`${this.name}.bulkPut(): ${m} of ${l} operations failed`,T)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:i,failures:s})=>{if(r===0)return i;throw new en(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,s)})}}function rn(t){var e={},n=function(o,h){if(h){for(var d=arguments.length,l=new Array(d-1);--d;)l[d-1]=arguments[d];return e[o].subscribe.apply(null,l),t}if(typeof o=="string")return e[o]};n.addEventType=s;for(var r=1,i=arguments.length;r<i;++r)s(arguments[r]);return n;function s(o,h,d){if(typeof o!="object"){var l;h||(h=Qi),d||(d=_e);var p={subscribers:[],fire:d,subscribe:function(m){p.subscribers.indexOf(m)===-1&&(p.subscribers.push(m),p.fire=h(p.fire,m))},unsubscribe:function(m){p.subscribers=p.subscribers.filter(function(g){return g!==m}),p.fire=p.subscribers.reduce(h,d)}};return e[o]=n[o]=p,p}Ke(l=o).forEach(function(m){var g=l[m];if(Le(g))s(m,l[m][0],l[m][1]);else{if(g!=="asap")throw new te.InvalidArgument("Invalid event config");var O=s(m,an,function(){for(var T=arguments.length,w=new Array(T);T--;)w[T]=arguments[T];O.subscribers.forEach(function(x){ni(function(){x.apply(null,w)})})})}})}}function Ht(t,e){return Vt(e).from({prototype:t}),e}function Lt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Hn(t,e){t.filter=Dt(t.filter,e)}function Xn(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>Dt(r(),e()):e,t.justLimit=n&&!r}function Cn(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new te.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Yr(t,e,n){const r=Cn(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function On(t,e,n,r){const i=t.replayFilter?Dt(t.filter,t.replayFilter()):t.filter;if(t.or){const s={},o=(h,d,l)=>{if(!i||i(d,l,g=>d.stop(g),g=>d.fail(g))){var p=d.primaryKey,m=""+p;m==="[object ArrayBuffer]"&&(m=""+new Uint8Array(p)),et(s,m)||(s[m]=!0,e(h,d,l))}};return Promise.all([t.or._iterate(o,n),Gr(Yr(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return Gr(Yr(t,r,n),Dt(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Gr(t,e,n,r){var i=ke(r?(s,o,h)=>n(r(s),o,h):n);return t.then(s=>{if(s)return s.start(()=>{var o=()=>s.continue();e&&!e(s,h=>o=h,h=>{s.stop(h),o=_e},h=>{s.fail(h),o=_e})||i(s.value,s,h=>o=h),o()})})}function qe(t,e){try{const n=zr(t),r=zr(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(i,s){const o=i.length,h=s.length,d=o<h?o:h;for(let l=0;l<d;++l)if(i[l]!==s[l])return i[l]<s[l]?-1:1;return o===h?0:o<h?-1:1}(Wr(t),Wr(e));case"Array":return function(i,s){const o=i.length,h=s.length,d=o<h?o:h;for(let l=0;l<d;++l){const p=qe(i[l],s[l]);if(p!==0)return p}return o===h?0:o<h?-1:1}(t,e)}}catch{}return NaN}function zr(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=nr(t);return n==="ArrayBuffer"?"binary":n}function Wr(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class uo{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,Re.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,Re.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=Dt(n.algorithm,e)}_iterate(e,n){return On(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Ve(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>On(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,i=r.table.core;if(Lt(r,!0))return i.count({trans:n,query:{index:Cn(r,i.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var s=0;return On(r,()=>(++s,!1),n,i).then(()=>s)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),i=r[0],s=r.length-1;function o(l,p){return p?o(l[r[p]],p-1):l[i]}var h=this._ctx.dir==="next"?1:-1;function d(l,p){var m=o(l,s),g=o(p,s);return m<g?-h:m>g?h:0}return this.toArray(function(l){return l.sort(d)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&Lt(r,!0)&&r.limit>0){const{valueMapper:i}=r,s=Cn(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:s,range:r.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return On(r,s=>i.push(s),n,r.table.core).then(()=>i)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,Lt(n)?Xn(n,()=>{var r=e;return(i,s)=>r===0||(r===1?(--r,!1):(s(()=>{i.advance(r),r=0}),!1))}):Xn(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Xn(this._ctx,()=>{var n=e;return function(r,i,s){return--n<=0&&i(s),n>=0}},!0),this}until(e,n){return Hn(this._ctx,function(r,i,s){return!e(r.value)||(i(s),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return Hn(this._ctx,function(i){return e(i.value)}),n=this._ctx,r=e,n.isMatch=Dt(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&Lt(n,!0)&&n.limit>0)return this._read(i=>{var s=Cn(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:s,range:n.range}})}).then(({result:i})=>i).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,s){r.push(s.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Hn(this._ctx,function(i){var s=i.primaryKey.toString(),o=et(r,s);return r[s]=!0,!o}),this}modify(e){var n=this._ctx;return this._write(r=>{var i;if(typeof e=="function")i=e;else{var s=Ke(e),o=s.length;i=function(w){for(var x=!1,A=0;A<o;++A){var _=s[A],S=e[_];_t(w,_)!==S&&(ft(w,_,S),x=!0)}return x}}const h=n.table.core,{outbound:d,extractKey:l}=h.schema.primaryKey,p=this.db._options.modifyChunkSize||200,m=[];let g=0;const O=[],T=(w,x)=>{const{failures:A,numFailures:_}=x;g+=w-_;for(let S of Ke(A))m.push(A[S])};return this.clone().primaryKeys().then(w=>{const x=A=>{const _=Math.min(p,w.length-A);return h.getMany({trans:r,keys:w.slice(A,A+_),cache:"immutable"}).then(S=>{const R=[],N=[],K=d?[]:null,j=[];for(let y=0;y<_;++y){const f=S[y],P={value:dn(f),primKey:w[A+y]};i.call(P,P.value,P)!==!1&&(P.value==null?j.push(w[A+y]):d||qe(l(f),l(P.value))===0?(N.push(P.value),d&&K.push(w[A+y])):(j.push(w[A+y]),R.push(P.value)))}const H=Lt(n)&&n.limit===1/0&&(typeof e!="function"||e===Qn)&&{index:n.index,range:n.range};return Promise.resolve(R.length>0&&h.mutate({trans:r,type:"add",values:R}).then(y=>{for(let f in y.failures)j.splice(parseInt(f),1);T(R.length,y)})).then(()=>(N.length>0||H&&typeof e=="object")&&h.mutate({trans:r,type:"put",keys:K,values:N,criteria:H,changeSpec:typeof e!="function"&&e}).then(y=>T(N.length,y))).then(()=>(j.length>0||H&&e===Qn)&&h.mutate({trans:r,type:"delete",keys:j,criteria:H}).then(y=>T(j.length,y))).then(()=>w.length>A+_&&x(A+p))})};return x(0).then(()=>{if(m.length>0)throw new Bn("Error modifying one or more objects",m,g,O);return w.length})})})}delete(){var e=this._ctx,n=e.range;return Lt(e)&&(e.isPrimKey&&!so||n.type===3)?this._write(r=>{const{primaryKey:i}=e.table.core.schema,s=n;return e.table.core.count({trans:r,query:{index:i,range:s}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:s}).then(({failures:h,lastResult:d,results:l,numFailures:p})=>{if(p)throw new Bn("Could not delete some values",Object.keys(h).map(m=>h[m]),o-p);return o-p}))}):this.modify(Qn)}}const Qn=(t,e)=>e.value=null;function co(t,e){return t<e?-1:t===e?0:1}function lo(t,e){return t>e?-1:t===e?0:1}function Ze(t,e,n){var r=t instanceof Ei?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Mt(t){return new t.Collection(t,()=>Si("")).limit(0)}function fo(t,e,n,r,i,s){for(var o=Math.min(t.length,r.length),h=-1,d=0;d<o;++d){var l=e[d];if(l!==r[d])return i(t[d],n[d])<0?t.substr(0,d)+n[d]+n.substr(d+1):i(t[d],r[d])<0?t.substr(0,d)+r[d]+n.substr(d+1):h>=0?t.substr(0,h)+e[h]+n.substr(h+1):null;i(t[d],l)<0&&(h=d)}return o<r.length&&s==="next"?t+n.substr(t.length):o<t.length&&s==="prev"?t.substr(0,n.length):h<0?null:t.substr(0,h)+r[h]+n.substr(h+1)}function Sn(t,e,n,r){var i,s,o,h,d,l,p,m=n.length;if(!n.every(w=>typeof w=="string"))return Ze(t,wi);function g(w){i=function(A){return A==="next"?_=>_.toUpperCase():_=>_.toLowerCase()}(w),s=function(A){return A==="next"?_=>_.toLowerCase():_=>_.toUpperCase()}(w),o=w==="next"?co:lo;var x=n.map(function(A){return{lower:s(A),upper:i(A)}}).sort(function(A,_){return o(A.lower,_.lower)});h=x.map(function(A){return A.upper}),d=x.map(function(A){return A.lower}),l=w,p=w==="next"?"":r}g("next");var O=new t.Collection(t,()=>Et(h[0],d[m-1]+r));O._ondirectionchange=function(w){g(w)};var T=0;return O._addAlgorithm(function(w,x,A){var _=w.key;if(typeof _!="string")return!1;var S=s(_);if(e(S,d,T))return!0;for(var R=null,N=T;N<m;++N){var K=fo(_,S,h[N],d[N],o,l);K===null&&R===null?T=N+1:(R===null||o(R,K)>0)&&(R=K)}return x(R!==null?function(){w.continue(R+p)}:A),!1}),O}function Et(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Si(t){return{type:1,lower:t,upper:t}}class Ei{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&(!r||!i)?Mt(this):new this.Collection(this,()=>Et(e,n,!r,!i))}catch{return Ze(this,vt)}}equals(e){return e==null?Ze(this,vt):new this.Collection(this,()=>Si(e))}above(e){return e==null?Ze(this,vt):new this.Collection(this,()=>Et(e,void 0,!0))}aboveOrEqual(e){return e==null?Ze(this,vt):new this.Collection(this,()=>Et(e,void 0,!1))}below(e){return e==null?Ze(this,vt):new this.Collection(this,()=>Et(void 0,e,!1,!0))}belowOrEqual(e){return e==null?Ze(this,vt):new this.Collection(this,()=>Et(void 0,e))}startsWith(e){return typeof e!="string"?Ze(this,wi):this.between(e,e+It,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Sn(this,(n,r)=>n.indexOf(r[0])===0,[e],It)}equalsIgnoreCase(e){return Sn(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=gt.apply($t,arguments);return e.length===0?Mt(this):Sn(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=gt.apply($t,arguments);return e.length===0?Mt(this):Sn(this,(n,r)=>r.some(i=>n.indexOf(i)===0),e,It)}anyOf(){const e=gt.apply($t,arguments);let n=this._cmp;try{e.sort(n)}catch{return Ze(this,vt)}if(e.length===0)return Mt(this);const r=new this.Collection(this,()=>Et(e[0],e[e.length-1]));r._ondirectionchange=s=>{n=s==="next"?this._ascending:this._descending,e.sort(n)};let i=0;return r._addAlgorithm((s,o,h)=>{const d=s.key;for(;n(d,e[i])>0;)if(++i,i===e.length)return o(h),!1;return n(d,e[i])===0||(o(()=>{s.continue(e[i])}),!1)}),r}notEqual(e){return this.inAnyRange([[pr,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=gt.apply($t,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ze(this,vt)}const n=e.reduce((r,i)=>r?r.concat([[r[r.length-1][1],i]]):[[pr,i]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,i=this._ascending,s=this._descending,o=this._min,h=this._max;if(e.length===0)return Mt(this);if(!e.every(_=>_[0]!==void 0&&_[1]!==void 0&&i(_[0],_[1])<=0))return Ze(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",te.InvalidArgument);const d=!n||n.includeLowers!==!1,l=n&&n.includeUppers===!0;let p,m=i;function g(_,S){return m(_[0],S[0])}try{p=e.reduce(function(_,S){let R=0,N=_.length;for(;R<N;++R){const K=_[R];if(r(S[0],K[1])<0&&r(S[1],K[0])>0){K[0]=o(K[0],S[0]),K[1]=h(K[1],S[1]);break}}return R===N&&_.push(S),_},[]),p.sort(g)}catch{return Ze(this,vt)}let O=0;const T=l?_=>i(_,p[O][1])>0:_=>i(_,p[O][1])>=0,w=d?_=>s(_,p[O][0])>0:_=>s(_,p[O][0])>=0;let x=T;const A=new this.Collection(this,()=>Et(p[0][0],p[p.length-1][1],!d,!l));return A._ondirectionchange=_=>{_==="next"?(x=T,m=i):(x=w,m=s),p.sort(g)},A._addAlgorithm((_,S,R)=>{for(var N=_.key;x(N);)if(++O,O===p.length)return S(R),!1;return!!function(K){return!T(K)&&!w(K)}(N)||(this._cmp(N,p[O][1])===0||this._cmp(N,p[O][0])===0||S(()=>{m===i?_.continue(p[O][0]):_.continue(p[O][1])}),!1)}),A}startsWithAnyOf(){const e=gt.apply($t,arguments);return e.every(n=>typeof n=="string")?e.length===0?Mt(this):this.inAnyRange(e.map(n=>[n,n+It])):Ze(this,"startsWithAnyOf() only works with strings")}}function ht(t){return ke(function(e){return cn(e),t(e.target.error),!1})}function cn(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const ln="storagemutated",Tt="x-storagemutated-1",Pt=rn(null,ln);class ho{_lock(){return Xt(!W.global),++this._reculock,this._reculock!==1||W.global||(W.lockOwnerFor=this),this}_unlock(){if(Xt(!W.global),--this._reculock==0)for(W.global||(W.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Wt(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&W.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Xt(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new te.DatabaseClosed(r);case"MissingAPIError":throw new te.MissingAPI(r.message,r);default:throw new te.OpenFailed(r)}if(!this.active)throw new te.TransactionInactive;return Xt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=ke(i=>{cn(i),this._reject(e.error)}),e.onabort=ke(i=>{cn(i),this.active&&this._reject(new te.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=ke(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Pt.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return Re(new te.ReadOnly("Transaction is readonly"));if(!this.active)return Re(new te.TransactionInactive);if(this._locked())return new $((s,o)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(s,o)},W])});if(r)return kt(()=>{var s=new $((o,h)=>{this._lock();const d=n(o,h,this);d&&d.then&&d.then(o,h)});return s.finally(()=>this._unlock()),s._lib=!0,s});var i=new $((s,o)=>{var h=n(s,o,this);h&&h.then&&h.then(s,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=$.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var s=n._waitingFor;return new $((o,h)=>{r.then(d=>n._waitingQueue.push(ke(o.bind(null,d))),d=>n._waitingQueue.push(ke(h.bind(null,d)))).finally(()=>{n._waitingFor===s&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new te.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(et(n,e))return n[e];const r=this.schema[e];if(!r)throw new te.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i}}function yr(t,e,n,r,i,s,o){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:s,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+Ai(e)}}function Ai(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Ti(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:ri(n,r=>[r.name,r])}}let fn=t=>{try{return t.only([[]]),fn=()=>[[]],[[]]}catch{return fn=()=>It,It}};function vr(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>_t(r,e)}(t):e=>_t(e,t)}function Hr(t){return[].slice.call(t)}let po=0;function on(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function yo(t,e,n){function r(d){if(d.type===3)return null;if(d.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:l,upper:p,lowerOpen:m,upperOpen:g}=d;return l===void 0?p===void 0?null:e.upperBound(p,!!g):p===void 0?e.lowerBound(l,!!m):e.bound(l,p,!!m,!!g)}const{schema:i,hasGetAll:s}=function(d,l){const p=Hr(d.objectStoreNames);return{schema:{name:d.name,tables:p.map(m=>l.objectStore(m)).map(m=>{const{keyPath:g,autoIncrement:O}=m,T=Le(g),w=g==null,x={},A={name:m.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w,compound:T,keyPath:g,autoIncrement:O,unique:!0,extractKey:vr(g)},indexes:Hr(m.indexNames).map(_=>m.index(_)).map(_=>{const{name:S,unique:R,multiEntry:N,keyPath:K}=_,j={name:S,compound:Le(K),keyPath:K,unique:R,multiEntry:N,extractKey:vr(K)};return x[on(K)]=j,j}),getIndexByKeyPath:_=>x[on(_)]};return x[":id"]=A.primaryKey,g!=null&&(x[on(g)]=A.primaryKey),A})},hasGetAll:p.length>0&&"getAll"in l.objectStore(p[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),o=i.tables.map(d=>function(l){const p=l.name;return{name:p,schema:l,mutate:function({trans:m,type:g,keys:O,values:T,range:w}){return new Promise((x,A)=>{x=ke(x);const _=m.objectStore(p),S=_.keyPath==null,R=g==="put"||g==="add";if(!R&&g!=="delete"&&g!=="deleteRange")throw new Error("Invalid operation type: "+g);const{length:N}=O||T||{length:1};if(O&&T&&O.length!==T.length)throw new Error("Given keys array must have same length as given values array.");if(N===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});let K;const j=[],H=[];let y=0;const f=E=>{++y,cn(E)};if(g==="deleteRange"){if(w.type===4)return x({numFailures:y,failures:H,results:[],lastResult:void 0});w.type===3?j.push(K=_.clear()):j.push(K=_.delete(r(w)))}else{const[E,Z]=R?S?[T,O]:[T,null]:[O,null];if(R)for(let q=0;q<N;++q)j.push(K=Z&&Z[q]!==void 0?_[g](E[q],Z[q]):_[g](E[q])),K.onerror=f;else for(let q=0;q<N;++q)j.push(K=_[g](E[q])),K.onerror=f}const P=E=>{const Z=E.target.result;j.forEach((q,se)=>q.error!=null&&(H[se]=q.error)),x({numFailures:y,failures:H,results:g==="delete"?O:j.map(q=>q.result),lastResult:Z})};K.onerror=E=>{f(E),P(E)},K.onsuccess=P})},getMany:({trans:m,keys:g})=>new Promise((O,T)=>{O=ke(O);const w=m.objectStore(p),x=g.length,A=new Array(x);let _,S=0,R=0;const N=j=>{const H=j.target;A[H._pos]=H.result,++R===S&&O(A)},K=ht(T);for(let j=0;j<x;++j)g[j]!=null&&(_=w.get(g[j]),_._pos=j,_.onsuccess=N,_.onerror=K,++S);S===0&&O(A)}),get:({trans:m,key:g})=>new Promise((O,T)=>{O=ke(O);const w=m.objectStore(p).get(g);w.onsuccess=x=>O(x.target.result),w.onerror=ht(T)}),query:function(m){return g=>new Promise((O,T)=>{O=ke(O);const{trans:w,values:x,limit:A,query:_}=g,S=A===1/0?void 0:A,{index:R,range:N}=_,K=w.objectStore(p),j=R.isPrimaryKey?K:K.index(R.name),H=r(N);if(A===0)return O({result:[]});if(m){const y=x?j.getAll(H,S):j.getAllKeys(H,S);y.onsuccess=f=>O({result:f.target.result}),y.onerror=ht(T)}else{let y=0;const f=x||!("openKeyCursor"in j)?j.openCursor(H):j.openKeyCursor(H),P=[];f.onsuccess=E=>{const Z=f.result;return Z?(P.push(x?Z.value:Z.primaryKey),++y===A?O({result:P}):void Z.continue()):O({result:P})},f.onerror=ht(T)}})}(s),openCursor:function({trans:m,values:g,query:O,reverse:T,unique:w}){return new Promise((x,A)=>{x=ke(x);const{index:_,range:S}=O,R=m.objectStore(p),N=_.isPrimaryKey?R:R.index(_.name),K=T?w?"prevunique":"prev":w?"nextunique":"next",j=g||!("openKeyCursor"in N)?N.openCursor(r(S),K):N.openKeyCursor(r(S),K);j.onerror=ht(A),j.onsuccess=ke(H=>{const y=j.result;if(!y)return void x(null);y.___id=++po,y.done=!1;const f=y.continue.bind(y);let P=y.continuePrimaryKey;P&&(P=P.bind(y));const E=y.advance.bind(y),Z=()=>{throw new Error("Cursor not stopped")};y.trans=m,y.stop=y.continue=y.continuePrimaryKey=y.advance=()=>{throw new Error("Cursor not started")},y.fail=ke(A),y.next=function(){let q=1;return this.start(()=>q--?this.continue():this.stop()).then(()=>this)},y.start=q=>{const se=new Promise((ce,Pe)=>{ce=ke(ce),j.onerror=ht(Pe),y.fail=Pe,y.stop=Ne=>{y.stop=y.continue=y.continuePrimaryKey=y.advance=Z,ce(Ne)}}),pe=()=>{if(j.result)try{q()}catch(ce){y.fail(ce)}else y.done=!0,y.start=()=>{throw new Error("Cursor behind last entry")},y.stop()};return j.onsuccess=ke(ce=>{j.onsuccess=pe,pe()}),y.continue=f,y.continuePrimaryKey=P,y.advance=E,pe(),se},x(y)},A)})},count({query:m,trans:g}){const{index:O,range:T}=m;return new Promise((w,x)=>{const A=g.objectStore(p),_=O.isPrimaryKey?A:A.index(O.name),S=r(T),R=S?_.count(S):_.count();R.onsuccess=ke(N=>w(N.target.result)),R.onerror=ht(x)})}}}(d)),h={};return o.forEach(d=>h[d.name]=d),{stack:"dbcore",transaction:t.transaction.bind(t),table(d){if(!h[d])throw new Error(`Table '${d}' not found`);return h[d]},MIN_KEY:-1/0,MAX_KEY:fn(e),schema:i}}function mr({_novip:t},e){const n=e.db,r=function(i,s,{IDBKeyRange:o,indexedDB:h},d){return{dbcore:function(p,m){return m.reduce((g,{create:O})=>({...g,...O(g)}),p)}(yo(s,o,d),i.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(i=>{const s=i.name;t.core.schema.tables.some(o=>o.name===s)&&(i.core=t.core.table(s),t[s]instanceof t.Table&&(t[s].core=i.core))})}function Un({_novip:t},e,n,r){n.forEach(i=>{const s=r[i];e.forEach(o=>{const h=xr(o,i);(!h||"value"in h&&h.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?wt(o,i,{get(){return this.table(i)},set(d){ei(this,i,{value:d,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new t.Table(i,s))})})}function gr({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function vo(t,e){return t._cfg.version-e._cfg.version}function mo(t,e,n,r){const i=t._dbSchema,s=t._createTransaction("readwrite",t._storeNames,i);s.create(n),s._completion.catch(r);const o=s._reject.bind(s),h=W.transless||W;kt(()=>{W.trans=s,W.transless=h,e===0?(Ke(i).forEach(d=>{Zn(n,d,i[d].primKey,i[d].indexes)}),mr(t,n),$.follow(()=>t.on.populate.fire(s)).catch(o)):function({_novip:d},l,p,m){const g=[],O=d._versions;let T=d._dbSchema=wr(d,d.idbdb,m),w=!1;const x=O.filter(_=>_._cfg.version>=l);function A(){return g.length?$.resolve(g.shift()(p.idbtrans)).then(A):$.resolve()}return x.forEach(_=>{g.push(()=>{const S=T,R=_._cfg.dbschema;_r(d,S,m),_r(d,R,m),T=d._dbSchema=R;const N=ki(S,R);N.add.forEach(j=>{Zn(m,j[0],j[1].primKey,j[1].indexes)}),N.change.forEach(j=>{if(j.recreate)throw new te.Upgrade("Not yet support for changing primary key");{const H=m.objectStore(j.name);j.add.forEach(y=>br(H,y)),j.change.forEach(y=>{H.deleteIndex(y.name),br(H,y)}),j.del.forEach(y=>H.deleteIndex(y))}});const K=_._cfg.contentUpgrade;if(K&&_._cfg.version>l){mr(d,m),p._memoizedTables={},w=!0;let j=ii(R);N.del.forEach(P=>{j[P]=S[P]}),gr(d,[d.Transaction.prototype]),Un(d,[d.Transaction.prototype],Ke(j),j),p.schema=j;const H=Pr(K);let y;H&&zt();const f=$.follow(()=>{if(y=K(p),y&&H){var P=Ot.bind(null,null);y.then(P,P)}});return y&&typeof y.then=="function"?$.resolve(y):f.then(()=>y)}}),g.push(S=>{(!w||!oo)&&function(R,N){[].slice.call(N.db.objectStoreNames).forEach(K=>R[K]==null&&N.db.deleteObjectStore(K))}(_._cfg.dbschema,S),gr(d,[d.Transaction.prototype]),Un(d,[d.Transaction.prototype],d._storeNames,d._dbSchema),p.schema=d._dbSchema})}),A().then(()=>{var _,S;S=m,Ke(_=T).forEach(R=>{S.db.objectStoreNames.contains(R)||Zn(S,R,_[R].primKey,_[R].indexes)})})}(t,e,s,n).catch(o)})}function ki(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const i=t[r],s=e[r];if(i){const o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!$n)o.recreate=!0,n.change.push(o);else{const h=i.idxByName,d=s.idxByName;let l;for(l in h)d[l]||o.del.push(l);for(l in d){const p=h[l],m=d[l];p?p.src!==m.src&&o.change.push(m):o.add.push(m)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,s])}return n}function Zn(t,e,n,r){const i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(s=>br(i,s)),i}function br(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function wr(t,e,n){const r={};return In(e.objectStoreNames,0).forEach(i=>{const s=n.objectStore(i);let o=s.keyPath;const h=yr(Ai(o),o||"",!1,!1,!!s.autoIncrement,o&&typeof o!="string",!0),d=[];for(let p=0;p<s.indexNames.length;++p){const m=s.index(s.indexNames[p]);o=m.keyPath;var l=yr(m.name,o,!!m.unique,!!m.multiEntry,!1,o&&typeof o!="string",!1);d.push(l)}r[i]=Ti(i,h,d)}),r}function _r({_novip:t},e,n){const r=n.db.objectStoreNames;for(let i=0;i<r.length;++i){const s=r[i],o=n.objectStore(s);t._hasGetAll="getAll"in o;for(let h=0;h<o.indexNames.length;++h){const d=o.indexNames[h],l=o.index(d).keyPath,p=typeof l=="string"?l:"["+In(l).join("+")+"]";if(e[s]){const m=e[s].idxByName[p];m&&(m.name=d,delete e[s].idxByName[p],e[s].idxByName[d]=m)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Te.WorkerGlobalScope&&Te instanceof Te.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class go{_parseStoresSpec(e,n){Ke(e).forEach(r=>{if(e[r]!==null){var i=e[r].split(",").map((o,h)=>{const d=(o=o.trim()).replace(/([&*]|\+\+)/g,""),l=/^\[/.test(d)?d.match(/^\[(.*)\]$/)[1].split("+"):d;return yr(d,l||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),Le(l),h===0)}),s=i.shift();if(s.multi)throw new te.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new te.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new te.Schema("Index must have a name and cannot be an empty string")}),n[r]=Ti(r,s,i)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?Ve(this._cfg.storesSource,e):e;const r=n._versions,i={};let s={};return r.forEach(o=>{Ve(i,o._cfg.storesSource),s=o._cfg.dbschema={},o._parseStoresSpec(i,s)}),n._dbSchema=s,gr(n,[n._allTables,n,n.Transaction.prototype]),Un(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],Ke(s),s),n._storeNames=Ke(s),this}upgrade(e){return this._cfg.contentUpgrade=jr(this._cfg.contentUpgrade||_e,e),this}}function Rr(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new Be(qn,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function Dr(t){return t&&typeof t.databases=="function"}function Or(t){return kt(function(){return W.letThrough=!0,t()})}function bo(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function wo(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Re(e.dbOpenError):t);dt&&(e.openCanceller._stackHolder=Ft()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new te.DatabaseClosed("db.open() was cancelled")}let s=e.dbReadyResolve,o=null,h=!1;const d=()=>new $((l,p)=>{if(i(),!n)throw new te.MissingAPI;const m=t.name,g=e.autoSchema?n.open(m):n.open(m,Math.round(10*t.verno));if(!g)throw new te.MissingAPI;g.onerror=ht(p),g.onblocked=ke(t._fireOnBlocked),g.onupgradeneeded=ke(O=>{if(o=g.transaction,e.autoSchema&&!t._options.allowEmptyDB){g.onerror=cn,o.abort(),g.result.close();const w=n.deleteDatabase(m);w.onsuccess=w.onerror=ke(()=>{p(new te.NoSuchDatabase(`Database ${m} doesnt exist`))})}else{o.onerror=ht(p);var T=O.oldVersion>Math.pow(2,62)?0:O.oldVersion;h=T<1,t._novip.idbdb=g.result,mo(t,T/10,o,p)}},p),g.onsuccess=ke(()=>{o=null;const O=t._novip.idbdb=g.result,T=In(O.objectStoreNames);if(T.length>0)try{const x=O.transaction((w=T).length===1?w[0]:w,"readonly");e.autoSchema?function({_novip:A},_,S){A.verno=_.version/10;const R=A._dbSchema=wr(0,_,S);A._storeNames=In(_.objectStoreNames,0),Un(A,[A._allTables],Ke(R),R)}(t,O,x):(_r(t,t._dbSchema,x),function(A,_){const S=ki(wr(0,A.idbdb,_),A._dbSchema);return!(S.add.length||S.change.some(R=>R.add.length||R.change.length))}(t,x)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),mr(t,x)}catch{}var w;nn.push(t),O.onversionchange=ke(x=>{e.vcFired=!0,t.on("versionchange").fire(x)}),O.onclose=ke(x=>{t.on("close").fire(x)}),h&&function({indexedDB:x,IDBKeyRange:A},_){!Dr(x)&&_!==qn&&Rr(x,A).put({name:_}).catch(_e)}(t._deps,m),l()},p)}).catch(l=>l&&l.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),d()):$.reject(l));return $.race([r,(typeof navigator>"u"?$.resolve():bo()).then(d)]).then(()=>(i(),e.onReadyBeingFired=[],$.resolve(Or(()=>t.on.ready.fire(t.vip))).then(function l(){if(e.onReadyBeingFired.length>0){let p=e.onReadyBeingFired.reduce(jr,_e);return e.onReadyBeingFired=[],$.resolve(Or(()=>p(t.vip))).then(l)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(l=>{e.dbOpenError=l;try{o&&o.abort()}catch{}return r===e.openCanceller&&t._close(),Re(l)}).finally(()=>{e.openComplete=!0,s()})}function Sr(t){var e=s=>t.next(s),n=i(e),r=i(s=>t.throw(s));function i(s){return o=>{var h=s(o),d=h.value;return h.done?d:d&&typeof d.then=="function"?d.then(n,r):Le(d)?Promise.all(d).then(n,r):n(d)}}return i(e)()}function _o(t,e,n){var r=arguments.length;if(r<2)throw new te.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[t,oi(i),n]}function xi(t,e,n,r,i){return $.resolve().then(()=>{const s=W.transless||W,o=t._createTransaction(e,n,t._dbSchema,r),h={trans:o,transless:s};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(m){return m.name===Cr.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>xi(t,e,n,null,i))):Re(m)}const d=Pr(i);let l;d&&zt();const p=$.follow(()=>{if(l=i.call(o,o),l)if(d){var m=Ot.bind(null,null);l.then(m,m)}else typeof l.next=="function"&&typeof l.throw=="function"&&(l=Sr(l))},h);return(l&&typeof l.then=="function"?$.resolve(l).then(m=>o.active?m:Re(new te.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):p.then(()=>l)).then(m=>(r&&o._resolve(),o._completion.then(()=>m))).catch(m=>(o._reject(m),Re(m)))})}function En(t,e,n){const r=Le(t)?t.slice():[t];for(let i=0;i<n;++i)r.push(e);return r}const Oo={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,i={},s=[];function o(p,m,g){const O=on(p),T=i[O]=i[O]||[],w=p==null?0:typeof p=="string"?1:p.length,x=m>0,A={...g,isVirtual:x,keyTail:m,keyLength:w,extractKey:vr(p),unique:!x&&g.unique};return T.push(A),A.isPrimaryKey||s.push(A),w>1&&o(w===2?p[0]:p.slice(0,w-1),m+1,g),T.sort((_,S)=>_.keyTail-S.keyTail),A}const h=o(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[h];for(const p of r.indexes)o(p.keyPath,0,p);function d(p){const m=p.query.index;return m.isVirtual?{...p,query:{index:m,range:(g=p.query.range,O=m.keyTail,{type:g.type===1?2:g.type,lower:En(g.lower,g.lowerOpen?t.MAX_KEY:t.MIN_KEY,O),lowerOpen:!0,upper:En(g.upper,g.upperOpen?t.MIN_KEY:t.MAX_KEY,O),upperOpen:!0})}}:p;var g,O}return{...n,schema:{...r,primaryKey:h,indexes:s,getIndexByKeyPath:function(p){const m=i[on(p)];return m&&m[0]}},count:p=>n.count(d(p)),query:p=>n.query(d(p)),openCursor(p){const{keyTail:m,isVirtual:g,keyLength:O}=p.query.index;return g?n.openCursor(d(p)).then(T=>T&&function(w){return Object.create(w,{continue:{value:function(A){A!=null?w.continue(En(A,p.reverse?t.MAX_KEY:t.MIN_KEY,m)):p.unique?w.continue(w.key.slice(0,O).concat(p.reverse?t.MIN_KEY:t.MAX_KEY,m)):w.continue()}},continuePrimaryKey:{value(A,_){w.continuePrimaryKey(En(A,t.MAX_KEY,m),_)}},primaryKey:{get:()=>w.primaryKey},key:{get(){const A=w.key;return O===1?A[0]:A.slice(0,O)}},value:{get:()=>w.value}})}(T)):n.openCursor(p)}}}}}};function Fr(t,e,n,r){return n=n||{},r=r||"",Ke(t).forEach(i=>{if(et(e,i)){var s=t[i],o=e[i];if(typeof s=="object"&&typeof o=="object"&&s&&o){const h=nr(s);h!==nr(o)?n[r+i]=e[i]:h==="Object"?Fr(s,o,n,r+i+"."):s!==o&&(n[r+i]=e[i])}else s!==o&&(n[r+i]=e[i])}else n[r+i]=void 0}),Ke(e).forEach(i=>{et(t,i)||(n[r+i]=e[i])}),n}const So={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(s){const o=W.trans,{deleting:h,creating:d,updating:l}=o.table(e).hook;switch(s.type){case"add":if(d.fire===_e)break;return o._promise("readwrite",()=>p(s),!0);case"put":if(d.fire===_e&&l.fire===_e)break;return o._promise("readwrite",()=>p(s),!0);case"delete":if(h.fire===_e)break;return o._promise("readwrite",()=>p(s),!0);case"deleteRange":if(h.fire===_e)break;return o._promise("readwrite",()=>function(g){return m(g.trans,g.range,1e4)}(s),!0)}return n.mutate(s);function p(g){const O=W.trans,T=g.keys||function(w,x){return x.type==="delete"?x.keys:x.keys||x.values.map(w.extractKey)}(r,g);if(!T)throw new Error("Keys missing");return(g=g.type==="add"||g.type==="put"?{...g,keys:T}:{...g}).type!=="delete"&&(g.values=[...g.values]),g.keys&&(g.keys=[...g.keys]),function(w,x,A){return x.type==="add"?Promise.resolve([]):w.getMany({trans:x.trans,keys:A,cache:"immutable"})}(n,g,T).then(w=>{const x=T.map((A,_)=>{const S=w[_],R={onerror:null,onsuccess:null};if(g.type==="delete")h.fire.call(R,A,S,O);else if(g.type==="add"||S===void 0){const N=d.fire.call(R,A,g.values[_],O);A==null&&N!=null&&(A=N,g.keys[_]=A,r.outbound||ft(g.values[_],r.keyPath,A))}else{const N=Fr(S,g.values[_]),K=l.fire.call(R,N,A,S,O);if(K){const j=g.values[_];Object.keys(K).forEach(H=>{et(j,H)?j[H]=K[H]:ft(j,H,K[H])})}}return R});return n.mutate(g).then(({failures:A,results:_,numFailures:S,lastResult:R})=>{for(let N=0;N<T.length;++N){const K=_?_[N]:T[N],j=x[N];K==null?j.onerror&&j.onerror(A[N]):j.onsuccess&&j.onsuccess(g.type==="put"&&w[N]?g.values[N]:K)}return{failures:A,results:_,numFailures:S,lastResult:R}}).catch(A=>(x.forEach(_=>_.onerror&&_.onerror(A)),Promise.reject(A)))})}function m(g,O,T){return n.query({trans:g,values:!1,query:{index:r,range:O},limit:T}).then(({result:w})=>p({type:"delete",keys:w,trans:g}).then(x=>x.numFailures>0?Promise.reject(x.failures[0]):w.length<T?{failures:[],numFailures:0,lastResult:void 0}:m(g,{...O,lower:w[w.length-1],lowerOpen:!0},T)))}}}}})};function Pi(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let i=0,s=0;i<e.keys.length&&s<t.length;++i)qe(e.keys[i],t[s])===0&&(r.push(n?dn(e.values[i]):e.values[i]),++s);return r.length===t.length?r:null}catch{return null}}const Eo={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const i=Pi(r.keys,r.trans._cache,r.cache==="clone");return i?$.resolve(i):n.getMany(r).then(s=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?dn(s):s},s))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function Ur(t){return!("from"in t)}const mt=function(t,e){if(!this){const n=new mt;return t&&"d"in t&&Ve(n,t),n}Ve(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function hn(t,e,n){const r=qe(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(Ur(t))return Ve(t,{from:e,to:n,d:1});const i=t.l,s=t.r;if(qe(n,t.from)<0)return i?hn(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Xr(t);if(qe(e,t.to)>0)return s?hn(s,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Xr(t);qe(e,t.from)<0&&(t.from=e,t.l=null,t.d=s?s.d+1:1),qe(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const o=!t.r;i&&!t.l&&Ln(t,i),s&&o&&Ln(t,s)}function Ln(t,e){Ur(e)||function n(r,{from:i,to:s,l:o,r:h}){hn(r,i,s),o&&n(r,o),h&&n(r,h)}(t,e)}function Ao(t,e){const n=Er(e);let r=n.next();if(r.done)return!1;let i=r.value;const s=Er(t);let o=s.next(i.from),h=o.value;for(;!r.done&&!o.done;){if(qe(h.from,i.to)<=0&&qe(h.to,i.from)>=0)return!0;qe(i.from,h.from)<0?i=(r=n.next(h.from)).value:h=(o=s.next(i.from)).value}return!1}function Er(t){let e=Ur(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&qe(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||qe(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Xr(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){const s=i==="r"?"l":"r",o={...t},h=t[i];t.from=h.from,t.to=h.to,t[i]=h[i],o[i]=h[s],t[s]=o,o.d=Qr(o)}t.d=Qr(t)}function Qr({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Gt(mt.prototype,{add(t){return Ln(this,t),this},addKey(t){return hn(this,t,t),this},addKeys(t){return t.forEach(e=>hn(this,e,e)),this},[rr](){return Er(this)}});const To={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new mt(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const i=t.table(r),{schema:s}=i,{primaryKey:o}=s,{extractKey:h,outbound:d}=o,l={...i,mutate:g=>{const O=g.trans,T=O.mutatedParts||(O.mutatedParts={}),w=K=>{const j=`idb://${e}/${r}/${K}`;return T[j]||(T[j]=new mt)},x=w(""),A=w(":dels"),{type:_}=g;let[S,R]=g.type==="deleteRange"?[g.range]:g.type==="delete"?[g.keys]:g.values.length<50?[[],g.values]:[];const N=g.trans._cache;return i.mutate(g).then(K=>{if(Le(S)){_!=="delete"&&(S=K.results),x.addKeys(S);const j=Pi(S,N);j||_==="add"||A.addKeys(S),(j||R)&&function(H,y,f,P){function E(Z){const q=H(Z.name||"");function se(ce){return ce!=null?Z.extractKey(ce):null}const pe=ce=>Z.multiEntry&&Le(ce)?ce.forEach(Pe=>q.addKey(Pe)):q.addKey(ce);(f||P).forEach((ce,Pe)=>{const Ne=f&&se(f[Pe]),ye=P&&se(P[Pe]);qe(Ne,ye)!==0&&(Ne!=null&&pe(Ne),ye!=null&&pe(ye))})}y.indexes.forEach(E)}(w,s,j,R)}else if(S){const j={from:S.lower,to:S.upper};A.add(j),x.add(j)}else x.add(n),A.add(n),s.indexes.forEach(j=>w(j.name).add(n));return K})}},p=({query:{index:g,range:O}})=>{var T,w;return[g,new mt((T=O.lower)!==null&&T!==void 0?T:t.MIN_KEY,(w=O.upper)!==null&&w!==void 0?w:t.MAX_KEY)]},m={get:g=>[o,new mt(g.key)],getMany:g=>[o,new mt().addKeys(g.keys)],count:p,query:p,openCursor:p};return Ke(m).forEach(g=>{l[g]=function(O){const{subscr:T}=W;if(T){const w=R=>{const N=`idb://${e}/${r}/${R}`;return T[N]||(T[N]=new mt)},x=w(""),A=w(":dels"),[_,S]=m[g](O);if(w(_.name||"").add(S),!_.isPrimaryKey){if(g!=="count"){const R=g==="query"&&d&&O.values&&i.query({...O,values:!1});return i[g].apply(this,arguments).then(N=>{if(g==="query"){if(d&&O.values)return R.then(({result:j})=>(x.addKeys(j),N));const K=O.values?N.result.map(h):N.result;O.values?x.addKeys(K):A.addKeys(K)}else if(g==="openCursor"){const K=N,j=O.values;return K&&Object.create(K,{key:{get:()=>(A.addKey(K.primaryKey),K.key)},primaryKey:{get(){const H=K.primaryKey;return A.addKey(H),H}},value:{get:()=>(j&&x.addKey(K.primaryKey),K.value)}})}return N})}A.add(n)}}return i[g].apply(this,arguments)}}),l}}}};class Be{constructor(e,n){this._middlewares={},this.verno=0;const r=Be.dependencies;this._options=n={addons:Be.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:i}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const s={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:_e,dbReadyPromise:null,cancelOpen:_e,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;s.dbReadyPromise=new $(h=>{s.dbReadyResolve=h}),s.openCanceller=new $((h,d)=>{s.cancelOpen=d}),this._state=s,this.name=e,this.on=rn(this,"populate","blocked","versionchange","close",{ready:[jr,_e]}),this.on.ready.subscribe=ti(this.on.ready.subscribe,h=>(d,l)=>{Be.vip(()=>{const p=this._state;if(p.openComplete)p.dbOpenError||$.resolve().then(d),l&&h(d);else if(p.onReadyBeingFired)p.onReadyBeingFired.push(d),l&&h(d);else{h(d);const m=this;l||h(function g(){m.on.ready.unsubscribe(d),m.on.ready.unsubscribe(g)})}})}),this.Collection=(o=this,Ht(uo.prototype,function(h,d){this.db=o;let l=Oi,p=null;if(d)try{l=d()}catch(T){p=T}const m=h._ctx,g=m.table,O=g.hook.reading.fire;this._ctx={table:g,index:m.index,isPrimKey:!m.index||g.schema.primKey.keyPath&&m.index===g.schema.primKey.name,range:l,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:p,or:m.or,valueMapper:O!==an?O:null}})),this.Table=function(h){return Ht(ao.prototype,function(d,l,p){this.db=h,this._tx=p,this.name=d,this.schema=l,this.hook=h._allTables[d]?h._allTables[d].hook:rn(null,{creating:[Wi,_e],reading:[zi,an],updating:[Xi,_e],deleting:[Hi,_e]})})}(this),this.Transaction=function(h){return Ht(ho.prototype,function(d,l,p,m,g){this.db=h,this.mode=d,this.storeNames=l,this.schema=p,this.chromeTransactionDurability=m,this.idbtrans=null,this.on=rn(this,"complete","error","abort"),this.parent=g||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $((O,T)=>{this._resolve=O,this._reject=T}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},O=>{var T=this.active;return this.active=!1,this.on.error.fire(O),this.parent?this.parent._reject(O):T&&this.idbtrans&&this.idbtrans.abort(),Re(O)})})}(this),this.Version=function(h){return Ht(go.prototype,function(d){this.db=h,this._cfg={version:d,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(h){return Ht(Ei.prototype,function(d,l,p){this.db=h,this._ctx={table:d,index:l===":id"?null:l,or:p};const m=h._deps.indexedDB;if(!m)throw new te.MissingAPI;this._cmp=this._ascending=m.cmp.bind(m),this._descending=(g,O)=>m.cmp(O,g),this._max=(g,O)=>m.cmp(g,O)>0?g:O,this._min=(g,O)=>m.cmp(g,O)<0?g:O,this._IDBKeyRange=h._deps.IDBKeyRange})}(this),this.on("versionchange",h=>{h.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",h=>{!h.newVersion||h.newVersion<h.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${h.oldVersion/10}`)}),this._maxKey=fn(n.IDBKeyRange),this._createTransaction=(h,d,l,p)=>new this.Transaction(h,d,l,this._options.chromeTransactionDurability,p),this._fireOnBlocked=h=>{this.on("blocked").fire(h),nn.filter(d=>d.name===this.name&&d!==this&&!d._state.vcFired).map(d=>d.on("versionchange").fire(h))},this.use(Oo),this.use(So),this.use(To),this.use(Eo),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(h=>h(this))}version(e){if(isNaN(e)||e<.1)throw new te.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new te.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(i=>i._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(vo),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||W.letThrough||this._vip)?e():new $((n,r)=>{if(this._state.openComplete)return r(new te.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new te.DatabaseClosed);this.open().catch(_e)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:i}){i&&this.unuse({stack:e,name:i});const s=this._middlewares[e]||(this._middlewares[e]=[]);return s.push({stack:e,create:n,level:r??10,name:i}),s.sort((o,h)=>o.level-h.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>r?i.create!==r:!!n&&i.name!==n)),this}open(){return wo(this)}_close(){const e=this._state,n=nn.indexOf(this);if(n>=0&&nn.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new $(r=>{e.dbReadyResolve=r}),e.openCanceller=new $((r,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new te.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new $((r,i)=>{const s=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=ke(()=>{(function({indexedDB:h,IDBKeyRange:d},l){!Dr(h)&&l!==qn&&Rr(h,d).delete(l).catch(_e)})(this._deps,this.name),r()}),o.onerror=ht(i),o.onblocked=this._fireOnBlocked};if(e)throw new te.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(s):s()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Ke(this._allTables).map(e=>this._allTables[e])}transaction(){const e=_o.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let i=W.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const s=e.indexOf("?")!==-1;let o,h;e=e.replace("!","").replace("?","");try{if(h=n.map(l=>{var p=l instanceof this.Table?l.name:l;if(typeof p!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return p}),e=="r"||e===zn)o=zn;else{if(e!="rw"&&e!=Wn)throw new te.InvalidArgument("Invalid transaction mode: "+e);o=Wn}if(i){if(i.mode===zn&&o===Wn){if(!s)throw new te.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&h.forEach(l=>{if(i&&i.storeNames.indexOf(l)===-1){if(!s)throw new te.SubTransaction("Table "+l+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(l){return i?i._promise(null,(p,m)=>{m(l)}):Re(l)}const d=xi.bind(null,this,o,h,i,r);return i?i._promise(o,d,"lock"):W.trans?Wt(W.transless,()=>this._whenReady(d)):this._whenReady(d)}table(e){if(!et(this._allTables,e))throw new te.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const ko=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class xo{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[ko](){return this}}function Ni(t,e){return Ke(e).forEach(n=>{Ln(t[n]||(t[n]=new mt),e[n])}),t}function Po(t){let e,n=!1;const r=new xo(i=>{const s=Pr(t);let o=!1,h={},d={};const l={get closed(){return o},unsubscribe:()=>{o=!0,Pt.storagemutated.unsubscribe(O)}};i.start&&i.start(l);let p=!1,m=!1;function g(){return Ke(d).some(w=>h[w]&&Ao(h[w],d[w]))}const O=w=>{Ni(h,w),g()&&T()},T=()=>{if(p||o)return;h={};const w={},x=function(A){s&&zt();const _=()=>kt(t,{subscr:A,trans:null}),S=W.trans?Wt(W.transless,_):_();return s&&S.then(Ot,Ot),S}(w);m||(Pt(ln,O),m=!0),p=!0,Promise.resolve(x).then(A=>{n=!0,e=A,p=!1,o||(g()?T():(h={},d=w,i.next&&i.next(A)))},A=>{p=!1,n=!1,i.error&&i.error(A),l.unsubscribe()})};return T(),l});return r.hasValue=()=>n,r.getValue=()=>e,r}let Ar;try{Ar={indexedDB:Te.indexedDB||Te.mozIndexedDB||Te.webkitIndexedDB||Te.msIndexedDB,IDBKeyRange:Te.IDBKeyRange||Te.webkitIDBKeyRange}}catch{Ar={indexedDB:null,IDBKeyRange:null}}const jt=Be;function jn(t){let e=bt;try{bt=!0,Pt.storagemutated.fire(t)}finally{bt=e}}Gt(jt,{...Tn,delete:t=>new jt(t,{addons:[]}).delete(),exists:t=>new jt(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return Dr(e)?Promise.resolve(e.databases()).then(r=>r.map(i=>i.name).filter(i=>i!==qn)):Rr(e,n).toCollection().primaryKeys()}(jt.dependencies).then(t)}catch{return Re(new te.MissingAPI)}},defineClass:()=>function(t){Ve(this,t)},ignoreTransaction:t=>W.trans?Wt(W.transless,t):t(),vip:Or,async:function(t){return function(){try{var e=Sr(t.apply(this,arguments));return e&&typeof e.then=="function"?e:$.resolve(e)}catch(n){return Re(n)}}},spawn:function(t,e,n){try{var r=Sr(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:$.resolve(r)}catch(i){return Re(i)}},currentTransaction:{get:()=>W.trans||null},waitFor:function(t,e){const n=$.resolve(typeof t=="function"?jt.ignoreTransaction(t):t).timeout(e||6e4);return W.trans?W.trans.waitFor(n):n},Promise:$,debug:{get:()=>dt,set:t=>{ai(t,t==="dexie"?()=>!0:_i)}},derive:Vt,extend:Ve,props:Gt,override:ti,Events:rn,on:Pt,liveQuery:Po,extendObservabilitySet:Ni,getByKeyPath:_t,setByKeyPath:ft,delByKeyPath:function(t,e){typeof e=="string"?ft(t,e,void 0):"length"in e&&[].map.call(e,function(n){ft(t,n,void 0)})},shallowClone:ii,deepClone:dn,getObjectDiff:Fr,cmp:qe,asap:ni,minKey:pr,addons:[],connections:nn,errnames:Cr,dependencies:Ar,semVer:Jr,version:Jr.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),jt.maxKey=fn(jt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Pt(ln,t=>{if(!bt){let e;$n?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Tt,!0,!0,t)):e=new CustomEvent(Tt,{detail:t}),bt=!0,dispatchEvent(e),bt=!1}}),addEventListener(Tt,({detail:t})=>{bt||jn(t)}));let bt=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(Tt);typeof t.unref=="function"&&t.unref(),Pt(ln,e=>{bt||t.postMessage(e)}),t.onmessage=e=>{e.data&&jn(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Pt(ln,e=>{try{bt||(typeof localStorage<"u"&&localStorage.setItem(Tt,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:Tt,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Tt){const n=JSON.parse(e.newValue);n&&jn(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===Tt&&jn(e.changedParts)})}$.rejectionMapper=function(t,e){if(!t||t instanceof Jt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Mr[t.name])return t;var n=new Mr[t.name](e||t.message,t);return"stack"in t&&wt(n,"stack",{get:function(){return this.inner.stack}}),n},ai(dt,_i);var Zr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Nt(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function h(p){try{l(r.next(p))}catch(m){o(m)}}function d(p){try{l(r.throw(p))}catch(m){o(m)}}function l(p){p.done?s(p.value):i(p.value).then(h,d)}l((r=r.apply(t,e||[])).next())})}function lt(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function h(l){return function(p){return d([l,p])}}function d(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(p){l=[6,p],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function No(t){var e=[t.schema.primKey].concat(t.schema.indexes);return e.map(function(n){return n.src}).join(",")}function Co(t){for(var e={},n=0,r=t.tables;n<r.length;n++){var i=r[n];e[i.name]=i.schema}return e}function Ci(t,e){return new Promise(function(n,r){var i=new FileReader;i.onabort=function(s){return r(new Error("file read aborted"))},i.onerror=function(s){return r(s.target.error)},i.onload=function(s){return n(s.target.result)},e==="binary"?i.readAsArrayBuffer(t):i.readAsText(t)})}function ji(t,e){if(typeof FileReaderSync>"u")throw new Error("FileReaderSync missing. Reading blobs synchronously requires code to run from within a web worker. Use TSON.encapsulateAsync() to do it from the main thread.");var n=new FileReaderSync,r=e==="binary"?n.readAsArrayBuffer(t):n.readAsText(t);return r}var Tr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lr(t,e){return e={exports:{}},t(e,e.exports),e.exports}var Vn=Lr(function(t,e){(function(n,r){t.exports=r()})(Tr,function(){function n(k){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?n=function(C){return typeof C}:n=function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},n(k)}function r(k,C,I,B,U,ie,le){try{var fe=k[ie](le),G=fe.value}catch(De){I(De);return}fe.done?C(G):Promise.resolve(G).then(B,U)}function i(k){return function(){var C=this,I=arguments;return new Promise(function(B,U){var ie=k.apply(C,I);function le(G){r(ie,B,U,le,fe,"next",G)}function fe(G){r(ie,B,U,le,fe,"throw",G)}le(void 0)})}}function s(k,C){if(!(k instanceof C))throw new TypeError("Cannot call a class as a function")}function o(k,C){for(var I=0;I<C.length;I++){var B=C[I];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(k,B.key,B)}}function h(k,C,I){return C&&o(k.prototype,C),I&&o(k,I),k}function d(k,C,I){return C in k?Object.defineProperty(k,C,{value:I,enumerable:!0,configurable:!0,writable:!0}):k[C]=I,k}function l(k,C){var I=Object.keys(k);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(k);C&&(B=B.filter(function(U){return Object.getOwnPropertyDescriptor(k,U).enumerable})),I.push.apply(I,B)}return I}function p(k){for(var C=1;C<arguments.length;C++){var I=arguments[C]!=null?arguments[C]:{};C%2?l(Object(I),!0).forEach(function(B){d(k,B,I[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(I)):l(Object(I)).forEach(function(B){Object.defineProperty(k,B,Object.getOwnPropertyDescriptor(I,B))})}return k}function m(k,C){return T(k)||x(k,C)||_()}function g(k){return O(k)||w(k)||A()}function O(k){if(Array.isArray(k)){for(var C=0,I=new Array(k.length);C<k.length;C++)I[C]=k[C];return I}}function T(k){if(Array.isArray(k))return k}function w(k){if(Symbol.iterator in Object(k)||Object.prototype.toString.call(k)==="[object Arguments]")return Array.from(k)}function x(k,C){if(Symbol.iterator in Object(k)||Object.prototype.toString.call(k)==="[object Arguments]"){var I=[],B=!0,U=!1,ie=void 0;try{for(var le=k[Symbol.iterator](),fe;!(B=(fe=le.next()).done)&&(I.push(fe.value),!(C&&I.length===C));B=!0);}catch(G){U=!0,ie=G}finally{try{!B&&le.return!=null&&le.return()}finally{if(U)throw ie}}return I}}function A(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var S=function k(C){s(this,k),this.p=new Promise(C)};S.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(S.prototype[Symbol.toStringTag]="TypesonPromise"),S.prototype.then=function(k,C){var I=this;return new S(function(B,U){I.p.then(function(ie){B(k?k(ie):ie)}).catch(function(ie){return C?C(ie):Promise.reject(ie)}).then(B,U)})},S.prototype.catch=function(k){return this.then(null,k)},S.resolve=function(k){return new S(function(C){C(k)})},S.reject=function(k){return new S(function(C,I){I(k)})},["all","race"].forEach(function(k){S[k]=function(C){return new S(function(I,B){Promise[k](C.map(function(U){return U&&U.constructor&&U.constructor.__typeson__type__==="TypesonPromise"?U.p:U})).then(I,B)})}});var R={},N=R.toString,K={}.hasOwnProperty,j=Object.getPrototypeOf,H=K.toString;function y(k,C){return q(k)&&typeof k.then=="function"&&(!C||typeof k.catch=="function")}function f(k){return N.call(k).slice(8,-1)}function P(k,C){if(!k||n(k)!=="object")return!1;var I=j(k);if(!I)return C===null;var B=K.call(I,"constructor")&&I.constructor;return typeof B!="function"?C===null:C===B||C!==null&&H.call(B)===H.call(C)||typeof C=="function"&&typeof B.__typeson__type__=="string"&&B.__typeson__type__===C.__typeson__type__}function E(k){if(!k||f(k)!=="Object")return!1;var C=j(k);return C?P(k,Object):!0}function Z(k){if(!k||f(k)!=="Object")return!1;var C=j(k);return C?P(k,Object)||Z(C):!0}function q(k){return k&&n(k)==="object"}function se(k){return k.replace(/~/g,"~0").replace(/\./g,"~1")}function pe(k){return k.replace(/~1/g,".").replace(/~0/g,"~")}function ce(k,C){if(C==="")return k;var I=C.indexOf(".");if(I>-1){var B=k[pe(C.slice(0,I))];return B===void 0?void 0:ce(B,C.slice(I+1))}return k[pe(C)]}function Pe(k,C,I){if(C==="")return I;var B=C.indexOf(".");if(B>-1){var U=k[pe(C.slice(0,B))];return Pe(U,C.slice(B+1),I)}return k[pe(C)]=I,k}function Ne(k){return k===null?"null":Array.isArray(k)?"array":n(k)}var ye=Object.keys,xe=Array.isArray,Je={}.hasOwnProperty,it=["type","replaced","iterateIn","iterateUnsetNumeric"];function ne(k,C){if(k.keypath==="")return-1;var I=k.keypath.match(/\./g)||0,B=C.keypath.match(/\./g)||0;return I&&(I=I.length),B&&(B=B.length),I>B?-1:I<B?1:k.keypath<C.keypath?-1:k.keypath>C.keypath}var Ee=function(){function k(C){s(this,k),this.options=C,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return h(k,[{key:"stringify",value:function(I,B,U,ie){ie=p({},this.options,{},ie,{stringification:!0});var le=this.encapsulate(I,null,ie);return xe(le)?JSON.stringify(le[0],B,U):le.then(function(fe){return JSON.stringify(fe,B,U)})}},{key:"stringifySync",value:function(I,B,U,ie){return this.stringify(I,B,U,p({throwOnBadSyncType:!0},ie,{sync:!0}))}},{key:"stringifyAsync",value:function(I,B,U,ie){return this.stringify(I,B,U,p({throwOnBadSyncType:!0},ie,{sync:!1}))}},{key:"parse",value:function(I,B,U){return U=p({},this.options,{},U,{parse:!0}),this.revive(JSON.parse(I,B),U)}},{key:"parseSync",value:function(I,B,U){return this.parse(I,B,p({throwOnBadSyncType:!0},U,{sync:!0}))}},{key:"parseAsync",value:function(I,B,U){return this.parse(I,B,p({throwOnBadSyncType:!0},U,{sync:!1}))}},{key:"specialTypeNames",value:function(I,B){var U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return U.returnTypeNames=!0,this.encapsulate(I,B,U)}},{key:"rootTypeName",value:function(I,B){var U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return U.iterateNone=!0,this.encapsulate(I,B,U)}},{key:"encapsulate",value:function(I,B,U){U=p({sync:!0},this.options,{},U);var ie=U,le=ie.sync,fe=this,G={},De=[],Ge=[],We=[],ot="cyclic"in U?U.cyclic:!0,st=U,pt=st.encapsulateObserver,He=be("",I,ot,B||{},We);function at(J){var c=Object.values(G);if(U.iterateNone)return c.length?c[0]:k.getJSONType(J);if(c.length){if(U.returnTypeNames)return g(new Set(c));!J||!E(J)||Je.call(J,"$types")?J={$:J,$types:{$:G}}:J.$types=G}else q(J)&&Je.call(J,"$types")&&(J={$:J,$types:!0});return U.returnTypeNames?!1:J}function Ce(J,c){return ge.apply(this,arguments)}function ge(){return ge=i(regeneratorRuntime.mark(function J(c,a){var u;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,Promise.all(a.map(function(D){return D[1].p}));case 2:return u=b.sent,b.next=5,Promise.all(u.map(function(){var D=i(regeneratorRuntime.mark(function L(Y){var M,Q,oe,ae,me,de,he,Oe,Se,re,Fe,V,F,X;return regeneratorRuntime.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(M=[],Q=a.splice(0,1),oe=m(Q,1),ae=oe[0],me=m(ae,7),de=me[0],he=me[2],Oe=me[3],Se=me[4],re=me[5],Fe=me[6],V=be(de,Y,he,Oe,M,!0,Fe),F=P(V,S),!(de&&F)){ee.next=11;break}return ee.next=8,V.p;case 8:return X=ee.sent,Se[re]=X,ee.abrupt("return",Ce(c,M));case 11:return de?Se[re]=V:F?c=V.p:c=V,ee.abrupt("return",Ce(c,M));case 13:case"end":return ee.stop()}},L)}));return function(L){return D.apply(this,arguments)}}()));case 5:return b.abrupt("return",c);case 6:case"end":return b.stop()}},J)})),ge.apply(this,arguments)}function ve(J,c,a){Object.assign(J,c);var u=it.map(function(v){var b=J[v];return delete J[v],b});a(),it.forEach(function(v,b){J[v]=u[b]})}function be(J,c,a,u,v,b,D){var L,Y={},M=n(c),Q=pt?function(F){var X=D||u.type||k.getJSONType(c);pt(Object.assign(F||Y,{keypath:J,value:c,cyclic:a,stateObj:u,promisesData:v,resolvingTypesonPromise:b,awaitingTypesonPromise:P(c,S)},{type:X}))}:null;if(["string","boolean","number","undefined"].includes(M))return c===void 0||M==="number"&&(isNaN(c)||c===-1/0||c===1/0)?(u.replaced?L=c:L=je(J,c,u,v,!1,b,Q),L!==c&&(Y={replaced:L})):L=c,Q&&Q(),L;if(c===null)return Q&&Q(),c;if(a&&!u.iterateIn&&!u.iterateUnsetNumeric&&c&&n(c)==="object"){var oe=De.indexOf(c);if(oe<0)a===!0&&(De.push(c),Ge.push(J));else return G[J]="#",Q&&Q({cyclicKeypath:Ge[oe]}),"#"+Ge[oe]}var ae=E(c),me=xe(c),de=(ae||me)&&(!fe.plainObjectReplacers.length||u.replaced)||u.iterateIn?c:je(J,c,u,v,ae||me,null,Q),he;if(de!==c?(L=de,Y={replaced:de}):J===""&&P(c,S)?(v.push([J,c,a,u,void 0,void 0,u.type]),L=c):me&&u.iterateIn!=="object"||u.iterateIn==="array"?(he=new Array(c.length),Y={clone:he}):!["function","symbol"].includes(n(c))&&!("toJSON"in c)&&!P(c,S)&&!P(c,Promise)&&!P(c,ArrayBuffer)||ae||u.iterateIn==="object"?(he={},u.addLength&&(he.length=c.length),Y={clone:he}):L=c,Q&&Q(),U.iterateNone)return he||L;if(!he)return L;if(u.iterateIn){var Oe=function(X){var z={ownKeys:Je.call(c,X)};ve(u,z,function(){var ee=J+(J?".":"")+se(X),ue=be(ee,c[X],!!a,u,v,b);P(ue,S)?v.push([ee,ue,!!a,u,he,X,u.type]):ue!==void 0&&(he[X]=ue)})};for(var Se in c)Oe(Se);Q&&Q({endIterateIn:!0,end:!0})}else ye(c).forEach(function(F){var X=J+(J?".":"")+se(F),z={ownKeys:!0};ve(u,z,function(){var ee=be(X,c[F],!!a,u,v,b);P(ee,S)?v.push([X,ee,!!a,u,he,F,u.type]):ee!==void 0&&(he[F]=ee)})}),Q&&Q({endIterateOwn:!0,end:!0});if(u.iterateUnsetNumeric){for(var re=c.length,Fe=function(X){if(!(X in c)){var z=J+(J?".":"")+X,ee={ownKeys:!1};ve(u,ee,function(){var ue=be(z,void 0,!!a,u,v,b);P(ue,S)?v.push([z,ue,!!a,u,he,X,u.type]):ue!==void 0&&(he[X]=ue)})}},V=0;V<re;V++)Fe(V);Q&&Q({endIterateUnsetNumeric:!0,end:!0})}return he}function je(J,c,a,u,v,b,D){for(var L=v?fe.plainObjectReplacers:fe.nonplainObjectReplacers,Y=L.length;Y--;){var M=L[Y];if(M.test(c,a)){var Q=M.type;if(fe.revivers[Q]){var oe=G[J];G[J]=oe?[Q].concat(oe):Q}if(Object.assign(a,{type:Q,replaced:!0}),(le||!M.replaceAsync)&&!M.replace)return D&&D({typeDetected:!0}),be(J,c,ot&&"readonly",a,u,b,Q);D&&D({replacing:!0});var ae=le||!M.replaceAsync?"replace":"replaceAsync";return be(J,M[ae](c,a),ot&&"readonly",a,u,b,Q)}}return c}return We.length?le&&U.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(Ce(He,We)).then(at):!le&&U.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():U.stringification&&le?[at(He)]:le?at(He):Promise.resolve(at(He))}},{key:"encapsulateSync",value:function(I,B,U){return this.encapsulate(I,B,p({throwOnBadSyncType:!0},U,{sync:!0}))}},{key:"encapsulateAsync",value:function(I,B,U){return this.encapsulate(I,B,p({throwOnBadSyncType:!0},U,{sync:!1}))}},{key:"revive",value:function(I,B){var U=I&&I.$types;if(!U)return I;if(U===!0)return I.$;B=p({sync:!0},this.options,{},B);var ie=B,le=ie.sync,fe=[],G={},De=!0;U.$&&E(U.$)&&(I=I.$,U=U.$,De=!1);var Ge=this;function We(ge,ve){var be=Ge.revivers[ge]||[],je=m(be,1),J=je[0];if(!J)throw new Error("Unregistered type: "+ge);return le&&!("revive"in J)?ve:J[le&&J.revive?"revive":!le&&J.reviveAsync?"reviveAsync":"revive"](ve,G)}function ot(){var ge=[];if(Object.entries(U).forEach(function(ve){var be=m(ve,2),je=be[0],J=be[1];J!=="#"&&[].concat(J).forEach(function(c){var a=Ge.revivers[c]||[null,{}],u=m(a,2),v=u[1].plain;v&&(ge.push({keypath:je,type:c}),delete U[je])})}),!!ge.length)return ge.sort(ne).reduce(function ve(be,je){var J=je.keypath,c=je.type;if(y(be))return be.then(function(v){return ve(v,{keypath:J,type:c})});var a=ce(I,J);if(a=We(c,a),P(a,S))return a.then(function(v){var b=Pe(I,J,v);b===v&&(I=b)});var u=Pe(I,J,a);u===a&&(I=u)},void 0)}var st=[];function pt(ge,ve,be,je,J){if(!(De&&ge==="$types")){var c=U[ge],a=xe(ve);if(a||E(ve)){var u=a?new Array(ve.length):{};for(ye(ve).forEach(function(oe){var ae=pt(ge+(ge?".":"")+se(oe),ve[oe],be||u,u,oe),me=function(he){return P(he,Ye)?u[oe]=void 0:he!==void 0&&(u[oe]=he),he};P(ae,S)?st.push(ae.then(function(de){return me(de)})):me(ae)}),ve=u;fe.length;){var v=m(fe[0],4),b=v[0],D=v[1],L=v[2],Y=v[3],M=ce(b,D);if(M!==void 0)L[Y]=M;else break;fe.splice(0,1)}}if(!c)return ve;if(c==="#"){var Q=ce(be,ve.slice(1));return Q===void 0&&fe.push([be,ve.slice(1),je,J]),Q}return[].concat(c).reduce(function oe(ae,me){return P(ae,S)?ae.then(function(de){return oe(de,me)}):We(me,ae)},ve)}}function He(ge){return P(ge,Ye)?void 0:ge}var at=ot(),Ce;return P(at,S)?Ce=at.then(function(){return I}):(Ce=pt("",I,null),st.length&&(Ce=S.resolve(Ce).then(function(ge){return S.all([ge].concat(st))}).then(function(ge){var ve=m(ge,1),be=ve[0];return be}))),y(Ce)?le&&B.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():P(Ce,S)?Ce.p.then(He):Ce:!le&&B.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():le?He(Ce):Promise.resolve(He(Ce))}},{key:"reviveSync",value:function(I,B){return this.revive(I,p({throwOnBadSyncType:!0},B,{sync:!0}))}},{key:"reviveAsync",value:function(I,B){return this.revive(I,p({throwOnBadSyncType:!0},B,{sync:!1}))}},{key:"register",value:function(I,B){return B=B||{},[].concat(I).forEach(function U(ie){var le=this;if(xe(ie))return ie.map(function(fe){return U.call(le,fe)});ie&&ye(ie).forEach(function(fe){if(fe==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(k.JSON_TYPES.includes(fe))throw new TypeError("Plain JSON object types are reserved as type names");var G=ie[fe],De=G&&G.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,Ge=De.filter(function(be){return be.type===fe});if(Ge.length&&(De.splice(De.indexOf(Ge[0]),1),delete this.revivers[fe],delete this.types[fe]),typeof G=="function"){var We=G;G={test:function(je){return je&&je.constructor===We},replace:function(je){return p({},je)},revive:function(je){return Object.assign(Object.create(We.prototype),je)}}}else if(xe(G)){var ot=G,st=m(ot,3),pt=st[0],He=st[1],at=st[2];G={test:pt,replace:He,revive:at}}if(!(!G||!G.test)){var Ce={type:fe,test:G.test.bind(G)};G.replace&&(Ce.replace=G.replace.bind(G)),G.replaceAsync&&(Ce.replaceAsync=G.replaceAsync.bind(G));var ge=typeof B.fallback=="number"?B.fallback:B.fallback?0:1/0;if(G.testPlainObjects?this.plainObjectReplacers.splice(ge,0,Ce):this.nonplainObjectReplacers.splice(ge,0,Ce),G.revive||G.reviveAsync){var ve={};G.revive&&(ve.revive=G.revive.bind(G)),G.reviveAsync&&(ve.reviveAsync=G.reviveAsync.bind(G)),this.revivers[fe]=[ve,{plain:G.testPlainObjects}]}this.types[fe]=G}},this)},this),this}}]),k}(),Ye=function k(){s(this,k)};return Ye.__typeson__type__="TypesonUndefined",Ee.Undefined=Ye,Ee.Promise=S,Ee.isThenable=y,Ee.toStringTag=f,Ee.hasConstructorOf=P,Ee.isObject=q,Ee.isPlainObject=E,Ee.isUserObject=Z,Ee.escapeKeyPathComponent=se,Ee.unescapeKeyPathComponent=pe,Ee.getByKeyPath=ce,Ee.getJSONType=Ne,Ee.JSON_TYPES=["null","boolean","number","string","array","object"],Ee})}),jo=Lr(function(t,e){(function(n,r){t.exports=r()})(Tr,function(){function n(c){return(n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(c)}function r(c,a){if(!(c instanceof a))throw new TypeError("Cannot call a class as a function")}function i(c,a){for(var u=0;u<a.length;u++){var v=a[u];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(c,v.key,v)}}function s(c,a,u){return a in c?Object.defineProperty(c,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[a]=u,c}function o(c,a){var u=Object.keys(c);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(c);a&&(v=v.filter(function(b){return Object.getOwnPropertyDescriptor(c,b).enumerable})),u.push.apply(u,v)}return u}function h(c){return function(u){if(Array.isArray(u))return d(u)}(c)||function(u){if(typeof Symbol<"u"&&Symbol.iterator in Object(u))return Array.from(u)}(c)||function(u,v){if(u){if(typeof u=="string")return d(u,v);var b=Object.prototype.toString.call(u).slice(8,-1);if(b==="Object"&&u.constructor&&(b=u.constructor.name),b==="Map"||b==="Set")return Array.from(u);if(b==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b))return d(u,v)}}(c)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function d(c,a){(a==null||a>c.length)&&(a=c.length);for(var u=0,v=new Array(a);u<a;u++)v[u]=c[u];return v}function l(c){return(l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(c)}function p(c,a){if(!(c instanceof a))throw new TypeError("Cannot call a class as a function")}function m(c,a){for(var u=0;u<a.length;u++){var v=a[u];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(c,v.key,v)}}function g(c,a,u){return a in c?Object.defineProperty(c,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[a]=u,c}function O(c,a){var u=Object.keys(c);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(c);a&&(v=v.filter(function(b){return Object.getOwnPropertyDescriptor(c,b).enumerable})),u.push.apply(u,v)}return u}function T(c){for(var a=1;a<arguments.length;a++){var u=arguments[a]!=null?arguments[a]:{};a%2?O(Object(u),!0).forEach(function(v){g(c,v,u[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(u)):O(Object(u)).forEach(function(v){Object.defineProperty(c,v,Object.getOwnPropertyDescriptor(u,v))})}return c}function w(c,a){return function(v){if(Array.isArray(v))return v}(c)||function(v,b){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(v)))){var D=[],L=!0,Y=!1,M=void 0;try{for(var Q,oe=v[Symbol.iterator]();!(L=(Q=oe.next()).done)&&(D.push(Q.value),!b||D.length!==b);L=!0);}catch(ae){Y=!0,M=ae}finally{try{L||oe.return==null||oe.return()}finally{if(Y)throw M}}return D}}(c,a)||A(c,a)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function x(c){return function(u){if(Array.isArray(u))return _(u)}(c)||function(u){if(typeof Symbol<"u"&&Symbol.iterator in Object(u))return Array.from(u)}(c)||A(c)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function A(c,a){if(c){if(typeof c=="string")return _(c,a);var u=Object.prototype.toString.call(c).slice(8,-1);return u==="Object"&&c.constructor&&(u=c.constructor.name),u==="Map"||u==="Set"?Array.from(c):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?_(c,a):void 0}}function _(c,a){(a==null||a>c.length)&&(a=c.length);for(var u=0,v=new Array(a);u<a;u++)v[u]=c[u];return v}var S=function c(a){p(this,c),this.p=new Promise(a)};S.__typeson__type__="TypesonPromise",typeof Symbol<"u"&&(S.prototype[Symbol.toStringTag]="TypesonPromise"),S.prototype.then=function(c,a){var u=this;return new S(function(v,b){u.p.then(function(D){v(c?c(D):D)}).catch(function(D){return a?a(D):Promise.reject(D)}).then(v,b)})},S.prototype.catch=function(c){return this.then(null,c)},S.resolve=function(c){return new S(function(a){a(c)})},S.reject=function(c){return new S(function(a,u){u(c)})},["all","race"].forEach(function(c){S[c]=function(a){return new S(function(u,v){Promise[c](a.map(function(b){return b&&b.constructor&&b.constructor.__typeson__type__==="TypesonPromise"?b.p:b})).then(u,v)})}});var R={}.toString,N={}.hasOwnProperty,K=Object.getPrototypeOf,j=N.toString;function H(c,a){return E(c)&&typeof c.then=="function"&&(!a||typeof c.catch=="function")}function y(c){return R.call(c).slice(8,-1)}function f(c,a){if(!c||l(c)!=="object")return!1;var u=K(c);if(!u)return a===null;var v=N.call(u,"constructor")&&u.constructor;return typeof v!="function"?a===null:a===v||a!==null&&j.call(v)===j.call(a)||typeof a=="function"&&typeof v.__typeson__type__=="string"&&v.__typeson__type__===a.__typeson__type__}function P(c){return!(!c||y(c)!=="Object")&&(!K(c)||f(c,Object))}function E(c){return c&&l(c)==="object"}function Z(c){return c.replace(/~/g,"~0").replace(/\./g,"~1")}function q(c){return c.replace(/~1/g,".").replace(/~0/g,"~")}function se(c,a){if(a==="")return c;var u=a.indexOf(".");if(u>-1){var v=c[q(a.slice(0,u))];return v===void 0?void 0:se(v,a.slice(u+1))}return c[q(a)]}function pe(c,a,u){if(a==="")return u;var v=a.indexOf(".");return v>-1?pe(c[q(a.slice(0,v))],a.slice(v+1),u):(c[q(a)]=u,c)}function ce(c,a,u){return u?a?a(c):c:(c&&c.then||(c=Promise.resolve(c)),a?c.then(a):c)}var Pe=Object.keys,Ne=Array.isArray,ye={}.hasOwnProperty,xe=["type","replaced","iterateIn","iterateUnsetNumeric"];function Je(c){return function(){for(var a=[],u=0;u<arguments.length;u++)a[u]=arguments[u];try{return Promise.resolve(c.apply(this,a))}catch(v){return Promise.reject(v)}}}function it(c,a){if(c.keypath==="")return-1;var u=c.keypath.match(/\./g)||0,v=a.keypath.match(/\./g)||0;return u&&(u=u.length),v&&(v=v.length),u>v?-1:u<v?1:c.keypath<a.keypath?-1:c.keypath>a.keypath}var ne=function(){function c(a){p(this,c),this.options=a,this.plainObjectReplacers=[],this.nonplainObjectReplacers=[],this.revivers={},this.types={}}return function(u,v,b){return v&&m(u.prototype,v),b&&m(u,b),u}(c,[{key:"stringify",value:function(u,v,b,D){D=T(T(T({},this.options),D),{},{stringification:!0});var L=this.encapsulate(u,null,D);return Ne(L)?JSON.stringify(L[0],v,b):L.then(function(Y){return JSON.stringify(Y,v,b)})}},{key:"stringifySync",value:function(u,v,b,D){return this.stringify(u,v,b,T(T({throwOnBadSyncType:!0},D),{},{sync:!0}))}},{key:"stringifyAsync",value:function(u,v,b,D){return this.stringify(u,v,b,T(T({throwOnBadSyncType:!0},D),{},{sync:!1}))}},{key:"parse",value:function(u,v,b){return b=T(T(T({},this.options),b),{},{parse:!0}),this.revive(JSON.parse(u,v),b)}},{key:"parseSync",value:function(u,v,b){return this.parse(u,v,T(T({throwOnBadSyncType:!0},b),{},{sync:!0}))}},{key:"parseAsync",value:function(u,v,b){return this.parse(u,v,T(T({throwOnBadSyncType:!0},b),{},{sync:!1}))}},{key:"specialTypeNames",value:function(u,v){var b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return b.returnTypeNames=!0,this.encapsulate(u,v,b)}},{key:"rootTypeName",value:function(u,v){var b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return b.iterateNone=!0,this.encapsulate(u,v,b)}},{key:"encapsulate",value:function(u,v,b){var D=Je(function(V,F){return ce(Promise.all(F.map(function(X){return X[1].p})),function(X){return ce(Promise.all(X.map(Je(function(z){var ee=!1,ue=[],Xe=w(F.splice(0,1),1),Ie=w(Xe[0],7),ze=Ie[0],tt=Ie[2],we=Ie[3],nt=Ie[4],Ae=Ie[5],Qe=Ie[6],Me=re(ze,z,tt,we,ue,!0,Qe),ut=f(Me,S);return function(Jn,vn){var Ut=Jn();return Ut&&Ut.then?Ut.then(vn):vn(Ut)}(function(){if(ze&&ut)return ce(Me.p,function(ct){return nt[Ae]=ct,ee=!0,D(V,ue)})},function(ct){return ee?ct:(ze?nt[Ae]=Me:V=ut?Me.p:Me,D(V,ue))})}))),function(){return V})})}),L=(b=T(T({sync:!0},this.options),b)).sync,Y=this,M={},Q=[],oe=[],ae=[],me=!("cyclic"in b)||b.cyclic,de=b.encapsulateObserver,he=re("",u,me,v||{},ae);function Oe(V){var F=Object.values(M);if(b.iterateNone)return F.length?F[0]:c.getJSONType(V);if(F.length){if(b.returnTypeNames)return x(new Set(F));V&&P(V)&&!ye.call(V,"$types")?V.$types=M:V={$:V,$types:{$:M}}}else E(V)&&ye.call(V,"$types")&&(V={$:V,$types:!0});return!b.returnTypeNames&&V}function Se(V,F,X){Object.assign(V,F);var z=xe.map(function(ee){var ue=V[ee];return delete V[ee],ue});X(),xe.forEach(function(ee,ue){V[ee]=z[ue]})}function re(V,F,X,z,ee,ue,Xe){var Ie,ze={},tt=l(F),we=de?function(St){var $e=Xe||z.type||c.getJSONType(F);de(Object.assign(St||ze,{keypath:V,value:F,cyclic:X,stateObj:z,promisesData:ee,resolvingTypesonPromise:ue,awaitingTypesonPromise:f(F,S)},{type:$e}))}:null;if(["string","boolean","number","undefined"].includes(tt))return F===void 0||Number.isNaN(F)||F===Number.NEGATIVE_INFINITY||F===Number.POSITIVE_INFINITY?(Ie=z.replaced?F:Fe(V,F,z,ee,!1,ue,we))!==F&&(ze={replaced:Ie}):Ie=F,we&&we(),Ie;if(F===null)return we&&we(),F;if(X&&!z.iterateIn&&!z.iterateUnsetNumeric&&F&&l(F)==="object"){var nt=Q.indexOf(F);if(!(nt<0))return M[V]="#",we&&we({cyclicKeypath:oe[nt]}),"#"+oe[nt];X===!0&&(Q.push(F),oe.push(V))}var Ae,Qe=P(F),Me=Ne(F),ut=(Qe||Me)&&(!Y.plainObjectReplacers.length||z.replaced)||z.iterateIn?F:Fe(V,F,z,ee,Qe||Me,null,we);if(ut!==F?(Ie=ut,ze={replaced:ut}):V===""&&f(F,S)?(ee.push([V,F,X,z,void 0,void 0,z.type]),Ie=F):Me&&z.iterateIn!=="object"||z.iterateIn==="array"?(Ae=new Array(F.length),ze={clone:Ae}):(["function","symbol"].includes(l(F))||"toJSON"in F||f(F,S)||f(F,Promise)||f(F,ArrayBuffer))&&!Qe&&z.iterateIn!=="object"?Ie=F:(Ae={},z.addLength&&(Ae.length=F.length),ze={clone:Ae}),we&&we(),b.iterateNone)return Ae||Ie;if(!Ae)return Ie;if(z.iterateIn){var ct=function($e){var yt={ownKeys:ye.call(F,$e)};Se(z,yt,function(){var Ct=V+(V?".":"")+Z($e),mn=re(Ct,F[$e],!!X,z,ee,ue);f(mn,S)?ee.push([Ct,mn,!!X,z,Ae,$e,z.type]):mn!==void 0&&(Ae[$e]=mn)})};for(var Jn in F)ct(Jn);we&&we({endIterateIn:!0,end:!0})}else Pe(F).forEach(function(St){var $e=V+(V?".":"")+Z(St);Se(z,{ownKeys:!0},function(){var yt=re($e,F[St],!!X,z,ee,ue);f(yt,S)?ee.push([$e,yt,!!X,z,Ae,St,z.type]):yt!==void 0&&(Ae[St]=yt)})}),we&&we({endIterateOwn:!0,end:!0});if(z.iterateUnsetNumeric){for(var vn=F.length,Ut=function($e){if(!($e in F)){var yt=V+(V?".":"")+$e;Se(z,{ownKeys:!1},function(){var Ct=re(yt,void 0,!!X,z,ee,ue);f(Ct,S)?ee.push([yt,Ct,!!X,z,Ae,$e,z.type]):Ct!==void 0&&(Ae[$e]=Ct)})}},Yn=0;Yn<vn;Yn++)Ut(Yn);we&&we({endIterateUnsetNumeric:!0,end:!0})}return Ae}function Fe(V,F,X,z,ee,ue,Xe){for(var Ie=ee?Y.plainObjectReplacers:Y.nonplainObjectReplacers,ze=Ie.length;ze--;){var tt=Ie[ze];if(tt.test(F,X)){var we=tt.type;if(Y.revivers[we]){var nt=M[V];M[V]=nt?[we].concat(nt):we}return Object.assign(X,{type:we,replaced:!0}),!L&&tt.replaceAsync||tt.replace?(Xe&&Xe({replacing:!0}),re(V,tt[L||!tt.replaceAsync?"replace":"replaceAsync"](F,X),me&&"readonly",X,z,ue,we)):(Xe&&Xe({typeDetected:!0}),re(V,F,me&&"readonly",X,z,ue,we))}}return F}return ae.length?L&&b.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():Promise.resolve(D(he,ae)).then(Oe):!L&&b.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():b.stringification&&L?[Oe(he)]:L?Oe(he):Promise.resolve(Oe(he))}},{key:"encapsulateSync",value:function(u,v,b){return this.encapsulate(u,v,T(T({throwOnBadSyncType:!0},b),{},{sync:!0}))}},{key:"encapsulateAsync",value:function(u,v,b){return this.encapsulate(u,v,T(T({throwOnBadSyncType:!0},b),{},{sync:!1}))}},{key:"revive",value:function(u,v){var b=u&&u.$types;if(!b)return u;if(b===!0)return u.$;var D=(v=T(T({sync:!0},this.options),v)).sync,L=[],Y={},M=!0;b.$&&P(b.$)&&(u=u.$,b=b.$,M=!1);var Q=this;function oe(Oe,Se){var re=w(Q.revivers[Oe]||[],1)[0];if(!re)throw new Error("Unregistered type: "+Oe);return D&&!("revive"in re)?Se:re[D&&re.revive?"revive":!D&&re.reviveAsync?"reviveAsync":"revive"](Se,Y)}var ae=[];function me(Oe){return f(Oe,Ee)?void 0:Oe}var de,he=function(){var Se=[];if(Object.entries(b).forEach(function(re){var Fe=w(re,2),V=Fe[0],F=Fe[1];F!=="#"&&[].concat(F).forEach(function(X){w(Q.revivers[X]||[null,{}],2)[1].plain&&(Se.push({keypath:V,type:X}),delete b[V])})}),Se.length)return Se.sort(it).reduce(function re(Fe,V){var F=V.keypath,X=V.type;if(H(Fe))return Fe.then(function(ue){return re(ue,{keypath:F,type:X})});var z=se(u,F);if(f(z=oe(X,z),S))return z.then(function(ue){var Xe=pe(u,F,ue);Xe===ue&&(u=Xe)});var ee=pe(u,F,z);ee===z&&(u=ee)},void 0)}();return f(he,S)?de=he.then(function(){return u}):(de=function Oe(Se,re,Fe,V,F){if(!M||Se!=="$types"){var X=b[Se],z=Ne(re);if(z||P(re)){var ee=z?new Array(re.length):{};for(Pe(re).forEach(function(Ae){var Qe=Oe(Se+(Se?".":"")+Z(Ae),re[Ae],Fe||ee,ee,Ae),Me=function(ct){return f(ct,Ee)?ee[Ae]=void 0:ct!==void 0&&(ee[Ae]=ct),ct};f(Qe,S)?ae.push(Qe.then(function(ut){return Me(ut)})):Me(Qe)}),re=ee;L.length;){var ue=w(L[0],4),Xe=ue[0],Ie=ue[1],ze=ue[2],tt=ue[3],we=se(Xe,Ie);if(we===void 0)break;ze[tt]=we,L.splice(0,1)}}if(!X)return re;if(X==="#"){var nt=se(Fe,re.slice(1));return nt===void 0&&L.push([Fe,re.slice(1),V,F]),nt}return[].concat(X).reduce(function Ae(Qe,Me){return f(Qe,S)?Qe.then(function(ut){return Ae(ut,Me)}):oe(Me,Qe)},re)}}("",u,null),ae.length&&(de=S.resolve(de).then(function(Oe){return S.all([Oe].concat(ae))}).then(function(Oe){return w(Oe,1)[0]}))),H(de)?D&&v.throwOnBadSyncType?function(){throw new TypeError("Sync method requested but async result obtained")}():f(de,S)?de.p.then(me):de:!D&&v.throwOnBadSyncType?function(){throw new TypeError("Async method requested but sync result obtained")}():D?me(de):Promise.resolve(me(de))}},{key:"reviveSync",value:function(u,v){return this.revive(u,T(T({throwOnBadSyncType:!0},v),{},{sync:!0}))}},{key:"reviveAsync",value:function(u,v){return this.revive(u,T(T({throwOnBadSyncType:!0},v),{},{sync:!1}))}},{key:"register",value:function(u,v){return v=v||{},[].concat(u).forEach(function b(D){var L=this;if(Ne(D))return D.map(function(Y){return b.call(L,Y)});D&&Pe(D).forEach(function(Y){if(Y==="#")throw new TypeError("# cannot be used as a type name as it is reserved for cyclic objects");if(c.JSON_TYPES.includes(Y))throw new TypeError("Plain JSON object types are reserved as type names");var M=D[Y],Q=M&&M.testPlainObjects?this.plainObjectReplacers:this.nonplainObjectReplacers,oe=Q.filter(function(Se){return Se.type===Y});if(oe.length&&(Q.splice(Q.indexOf(oe[0]),1),delete this.revivers[Y],delete this.types[Y]),typeof M=="function"){var ae=M;M={test:function(re){return re&&re.constructor===ae},replace:function(re){return T({},re)},revive:function(re){return Object.assign(Object.create(ae.prototype),re)}}}else if(Ne(M)){var me=w(M,3);M={test:me[0],replace:me[1],revive:me[2]}}if(M&&M.test){var de={type:Y,test:M.test.bind(M)};M.replace&&(de.replace=M.replace.bind(M)),M.replaceAsync&&(de.replaceAsync=M.replaceAsync.bind(M));var he=typeof v.fallback=="number"?v.fallback:v.fallback?0:Number.POSITIVE_INFINITY;if(M.testPlainObjects?this.plainObjectReplacers.splice(he,0,de):this.nonplainObjectReplacers.splice(he,0,de),M.revive||M.reviveAsync){var Oe={};M.revive&&(Oe.revive=M.revive.bind(M)),M.reviveAsync&&(Oe.reviveAsync=M.reviveAsync.bind(M)),this.revivers[Y]=[Oe,{plain:M.testPlainObjects}]}this.types[Y]=M}},this)},this),this}}]),c}(),Ee=function c(){p(this,c)};Ee.__typeson__type__="TypesonUndefined",ne.Undefined=Ee,ne.Promise=S,ne.isThenable=H,ne.toStringTag=y,ne.hasConstructorOf=f,ne.isObject=E,ne.isPlainObject=P,ne.isUserObject=function c(a){if(!a||y(a)!=="Object")return!1;var u=K(a);return!u||f(a,Object)||c(u)},ne.escapeKeyPathComponent=Z,ne.unescapeKeyPathComponent=q,ne.getByKeyPath=se,ne.getJSONType=function(a){return a===null?"null":Array.isArray(a)?"array":l(a)},ne.JSON_TYPES=["null","boolean","number","string","array","object"];for(var Ye={userObject:{test:function(a,u){return ne.isUserObject(a)},replace:function(a){return function(v){for(var b=1;b<arguments.length;b++){var D=arguments[b]!=null?arguments[b]:{};b%2?o(Object(D),!0).forEach(function(L){s(v,L,D[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(D)):o(Object(D)).forEach(function(L){Object.defineProperty(v,L,Object.getOwnPropertyDescriptor(D,L))})}return v}({},a)},revive:function(a){return a}}},k=[{arrayNonindexKeys:{testPlainObjects:!0,test:function(a,u){return!!Array.isArray(a)&&(Object.keys(a).some(function(v){return String(Number.parseInt(v))!==v})&&(u.iterateIn="object",u.addLength=!0),!0)},replace:function(a,u){return u.iterateUnsetNumeric=!0,a},revive:function(a){if(Array.isArray(a))return a;var u=[];return Object.keys(a).forEach(function(v){var b=a[v];u[v]=b}),u}}},{sparseUndefined:{test:function(a,u){return a===void 0&&u.ownKeys===!1},replace:function(a){return 0},revive:function(a){}}}],C={undef:{test:function(a,u){return a===void 0&&(u.ownKeys||!("ownKeys"in u))},replace:function(a){return 0},revive:function(a){return new ne.Undefined}}},I={StringObject:{test:function(a){return ne.toStringTag(a)==="String"&&n(a)==="object"},replace:function(a){return String(a)},revive:function(a){return new String(a)}},BooleanObject:{test:function(a){return ne.toStringTag(a)==="Boolean"&&n(a)==="object"},replace:function(a){return!!a},revive:function(a){return new Boolean(a)}},NumberObject:{test:function(a){return ne.toStringTag(a)==="Number"&&n(a)==="object"},replace:function(a){return Number(a)},revive:function(a){return new Number(a)}}},B=[{nan:{test:function(a){return Number.isNaN(a)},replace:function(a){return"NaN"},revive:function(a){return Number.NaN}}},{infinity:{test:function(a){return a===Number.POSITIVE_INFINITY},replace:function(a){return"Infinity"},revive:function(a){return Number.POSITIVE_INFINITY}}},{negativeInfinity:{test:function(a){return a===Number.NEGATIVE_INFINITY},replace:function(a){return"-Infinity"},revive:function(a){return Number.NEGATIVE_INFINITY}}}],U={date:{test:function(a){return ne.toStringTag(a)==="Date"},replace:function(a){var u=a.getTime();return Number.isNaN(u)?"NaN":u},revive:function(a){return a==="NaN"?new Date(Number.NaN):new Date(a)}}},ie={regexp:{test:function(a){return ne.toStringTag(a)==="RegExp"},replace:function(a){return{source:a.source,flags:(a.global?"g":"")+(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.sticky?"y":"")+(a.unicode?"u":"")}},revive:function(a){var u=a.source,v=a.flags;return new RegExp(u,v)}}},le={map:{test:function(a){return ne.toStringTag(a)==="Map"},replace:function(a){return h(a.entries())},revive:function(a){return new Map(a)}}},fe={set:{test:function(a){return ne.toStringTag(a)==="Set"},replace:function(a){return h(a.values())},revive:function(a){return new Set(a)}}},G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",De=new Uint8Array(256),Ge=0;Ge<G.length;Ge++)De[G.charCodeAt(Ge)]=Ge;var We=function(a,u,v){v==null&&(v=a.byteLength);for(var b=new Uint8Array(a,u||0,v),D=b.length,L="",Y=0;Y<D;Y+=3)L+=G[b[Y]>>2],L+=G[(3&b[Y])<<4|b[Y+1]>>4],L+=G[(15&b[Y+1])<<2|b[Y+2]>>6],L+=G[63&b[Y+2]];return D%3==2?L=L.slice(0,-1)+"=":D%3==1&&(L=L.slice(0,-2)+"=="),L},ot=function(a){var u,v,b,D,L=a.length,Y=.75*a.length,M=0;a[a.length-1]==="="&&(Y--,a[a.length-2]==="="&&Y--);for(var Q=new ArrayBuffer(Y),oe=new Uint8Array(Q),ae=0;ae<L;ae+=4)u=De[a.charCodeAt(ae)],v=De[a.charCodeAt(ae+1)],b=De[a.charCodeAt(ae+2)],D=De[a.charCodeAt(ae+3)],oe[M++]=u<<2|v>>4,oe[M++]=(15&v)<<4|b>>2,oe[M++]=(3&b)<<6|63&D;return Q},st={arraybuffer:{test:function(a){return ne.toStringTag(a)==="ArrayBuffer"},replace:function(a,u){u.buffers||(u.buffers=[]);var v=u.buffers.indexOf(a);return v>-1?{index:v}:(u.buffers.push(a),We(a))},revive:function(a,u){if(u.buffers||(u.buffers=[]),n(a)==="object")return u.buffers[a.index];var v=ot(a);return u.buffers.push(v),v}}},pt=typeof self>"u"?Tr:self,He={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(c){var a=c,u=pt[a];u&&(He[c.toLowerCase()]={test:function(b){return ne.toStringTag(b)===a},replace:function(b,D){var L=b.buffer,Y=b.byteOffset,M=b.length;D.buffers||(D.buffers=[]);var Q=D.buffers.indexOf(L);return Q>-1?{index:Q,byteOffset:Y,length:M}:(D.buffers.push(L),{encoded:We(L),byteOffset:Y,length:M})},revive:function(b,D){D.buffers||(D.buffers=[]);var L,Y=b.byteOffset,M=b.length,Q=b.encoded,oe=b.index;return"index"in b?L=D.buffers[oe]:(L=ot(Q),D.buffers.push(L)),new u(L,Y,M)}})});var at={dataview:{test:function(a){return ne.toStringTag(a)==="DataView"},replace:function(a,u){var v=a.buffer,b=a.byteOffset,D=a.byteLength;u.buffers||(u.buffers=[]);var L=u.buffers.indexOf(v);return L>-1?{index:L,byteOffset:b,byteLength:D}:(u.buffers.push(v),{encoded:We(v),byteOffset:b,byteLength:D})},revive:function(a,u){u.buffers||(u.buffers=[]);var v,b=a.byteOffset,D=a.byteLength,L=a.encoded,Y=a.index;return"index"in a?v=u.buffers[Y]:(v=ot(L),u.buffers.push(v)),new DataView(v,b,D)}}},Ce={IntlCollator:{test:function(a){return ne.hasConstructorOf(a,Intl.Collator)},replace:function(a){return a.resolvedOptions()},revive:function(a){return new Intl.Collator(a.locale,a)}},IntlDateTimeFormat:{test:function(a){return ne.hasConstructorOf(a,Intl.DateTimeFormat)},replace:function(a){return a.resolvedOptions()},revive:function(a){return new Intl.DateTimeFormat(a.locale,a)}},IntlNumberFormat:{test:function(a){return ne.hasConstructorOf(a,Intl.NumberFormat)},replace:function(a){return a.resolvedOptions()},revive:function(a){return new Intl.NumberFormat(a.locale,a)}}};function ge(c){for(var a=new Uint8Array(c.length),u=0;u<c.length;u++)a[u]=c.charCodeAt(u);return a.buffer}var ve={file:{test:function(a){return ne.toStringTag(a)==="File"},replace:function(a){var u=new XMLHttpRequest;if(u.overrideMimeType("text/plain; charset=x-user-defined"),u.open("GET",URL.createObjectURL(a),!1),u.send(),u.status!==200&&u.status!==0)throw new Error("Bad File access: "+u.status);return{type:a.type,stringContents:u.responseText,name:a.name,lastModified:a.lastModified}},revive:function(a){var u=a.name,v=a.type,b=a.stringContents,D=a.lastModified;return new File([ge(b)],u,{type:v,lastModified:D})},replaceAsync:function(a){return new ne.Promise(function(u,v){var b=new FileReader;b.addEventListener("load",function(){u({type:a.type,stringContents:b.result,name:a.name,lastModified:a.lastModified})}),b.addEventListener("error",function(){v(b.error)}),b.readAsBinaryString(a)})}}},be={bigint:{test:function(a){return typeof a=="bigint"},replace:function(a){return String(a)},revive:function(a){return BigInt(a)}}},je={bigintObject:{test:function(a){return n(a)==="object"&&ne.hasConstructorOf(a,BigInt)},replace:function(a){return String(a)},revive:function(a){return new Object(BigInt(a))}}},J={cryptokey:{test:function(a){return ne.toStringTag(a)==="CryptoKey"&&a.extractable},replaceAsync:function(a){return new ne.Promise(function(u,v){crypto.subtle.exportKey("jwk",a).catch(function(b){v(b)}).then(function(b){u({jwk:b,algorithm:a.algorithm,usages:a.usages})})})},revive:function(a){var u=a.jwk,v=a.algorithm,b=a.usages;return crypto.subtle.importKey("jwk",u,v,!0,b)}}};return[Ye,C,k,I,B,U,ie,{imagedata:{test:function(a){return ne.toStringTag(a)==="ImageData"},replace:function(a){return{array:h(a.data),width:a.width,height:a.height}},revive:function(a){return new ImageData(new Uint8ClampedArray(a.array),a.width,a.height)}}},{imagebitmap:{test:function(a){return ne.toStringTag(a)==="ImageBitmap"||a&&a.dataset&&a.dataset.toStringTag==="ImageBitmap"},replace:function(a){var u=document.createElement("canvas");return u.getContext("2d").drawImage(a,0,0),u.toDataURL()},revive:function(a){var u=document.createElement("canvas"),v=u.getContext("2d"),b=document.createElement("img");return b.addEventListener("load",function(){v.drawImage(b,0,0)}),b.src=a,u},reviveAsync:function(a){var u=document.createElement("canvas"),v=u.getContext("2d"),b=document.createElement("img");return b.addEventListener("load",function(){v.drawImage(b,0,0)}),b.src=a,createImageBitmap(u)}}},ve,{file:ve.file,filelist:{test:function(a){return ne.toStringTag(a)==="FileList"},replace:function(a){for(var u=[],v=0;v<a.length;v++)u[v]=a.item(v);return u},revive:function(a){return new(function(){function u(){r(this,u),this._files=arguments[0],this.length=this._files.length}return function(b,D,L){return D&&i(b.prototype,D),L&&i(b,L),b}(u,[{key:"item",value:function(b){return this._files[b]}},{key:Symbol.toStringTag,get:function(){return"FileList"}}]),u}())(a)}}},{blob:{test:function(a){return ne.toStringTag(a)==="Blob"},replace:function(a){var u=new XMLHttpRequest;if(u.overrideMimeType("text/plain; charset=x-user-defined"),u.open("GET",URL.createObjectURL(a),!1),u.send(),u.status!==200&&u.status!==0)throw new Error("Bad Blob access: "+u.status);return{type:a.type,stringContents:u.responseText}},revive:function(a){var u=a.type,v=a.stringContents;return new Blob([ge(v)],{type:u})},replaceAsync:function(a){return new ne.Promise(function(u,v){var b=new FileReader;b.addEventListener("load",function(){u({type:a.type,stringContents:b.result})}),b.addEventListener("error",function(){v(b.error)}),b.readAsBinaryString(a)})}}}].concat(typeof Map=="function"?le:[],typeof Set=="function"?fe:[],typeof ArrayBuffer=="function"?st:[],typeof Uint8Array=="function"?He:[],typeof DataView=="function"?at:[],typeof Intl<"u"?Ce:[],typeof crypto<"u"?J:[],typeof BigInt<"u"?[be,je]:[])})}),qt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Zt=new Uint8Array(256);for(var An=0;An<qt.length;An++)Zt[qt.codePointAt(An)]=An;var kr=function(e,n,r){r==null&&(r=e.byteLength);for(var i=new Uint8Array(e,n||0,r),s=i.length,o="",h=0;h<s;h+=3)o+=qt[i[h]>>2],o+=qt[(i[h]&3)<<4|i[h+1]>>4],o+=qt[(i[h+1]&15)<<2|i[h+2]>>6],o+=qt[i[h+2]&63];return s%3===2?o=o.slice(0,-1)+"=":s%3===1&&(o=o.slice(0,-2)+"=="),o},Ii=function(e){var n=e.length,r=e.length*.75,i=0,s,o,h,d;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);for(var l=new ArrayBuffer(r),p=new Uint8Array(l),m=0;m<n;m+=4)s=Zt[e.codePointAt(m)],o=Zt[e.codePointAt(m+1)],h=Zt[e.codePointAt(m+2)],d=Zt[e.codePointAt(m+3)],p[i++]=s<<2|o>>4,p[i++]=(o&15)<<4|h>>2,p[i++]=(h&3)<<6|d&63;return l},Io=typeof self>"u"?global:self,Bi={};["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"].forEach(function(t){var e=t,n=Io[e];n&&(Bi[t.toLowerCase()+"2"]={test:function(r){return Vn.toStringTag(r)===e},replace:function(r){var i=r.buffer,s=r.byteOffset,o=r.length;return{buffer:i,byteOffset:s,length:o}},revive:function(r){var i=r.buffer,s=r.byteOffset,o=r.length;return new n(i,s,o)}})});var Bo={arraybuffer:{test:function(t){return Vn.toStringTag(t)==="ArrayBuffer"},replace:function(t){return kr(t,0,t.byteLength)},revive:function(t){var e=Ii(t);return e}}},rt=new Vn().register(jo),Ko="FileReaderSync"in self,Mn=[],er=0;rt.register([Bo,Bi,{blob2:{test:function(t){return Vn.toStringTag(t)==="Blob"},replace:function(t){if(t.isClosed)throw new Error("The Blob is closed");if(Ko){var e=ji(t,"binary"),n=kr(e,0,e.byteLength);return{type:t.type,data:n}}else{Mn.push(t);var r={type:t.type,data:{start:er,end:er+t.size}};return er+=t.size,r}},finalize:function(t,e){t.data=kr(e,0,e.byteLength)},revive:function(t){var e=t.type,n=t.data;return new Blob([Ii(n)],{type:e})}}}]);rt.mustFinalize=function(){return Mn.length>0};rt.finalize=function(t){return Nt(void 0,void 0,void 0,function(){var e,n,r,i,s,o,h,d,l,p;return lt(this,function(m){switch(m.label){case 0:return[4,Ci(new Blob(Mn),"binary")];case 1:if(e=m.sent(),t){for(n=0,r=t;n<r.length;n++)if(i=r[n],i.$types){s=i.$types,o=s.$,o&&(s=s.$);for(h in s)d=s[h],l=rt.types[d],l&&l.finalize&&(p=Be.getByKeyPath(i,o?"$."+h:h),l.finalize(p,e.slice(p.start,p.end)))}}return Mn=[],[2]}})})};var Ro=2e3;function Do(t,e){return Nt(this,void 0,void 0,function(){function n(){return Nt(this,void 0,void 0,function(){var m,g,O,T,w,x,A,_,S,R;return lt(this,function(N){switch(N.label){case 0:return[4,Promise.all(i.map(function(K){return K.count()}))];case 1:m=N.sent(),m.forEach(function(K,j){return o[j].rowCount=K}),p.totalRows=m.reduce(function(K,j){return K+j}),g=JSON.stringify(d,void 0,h?2:void 0),O=g.lastIndexOf("]"),T=g.substring(0,O),s.push(T),w=e.filter,x=e.transform,A=function(K){var j,H,y,f,P,E,Z,q,se,pe,ce,Pe;return lt(this,function(Ne){switch(Ne.label){case 0:j=t.table(K),H=j.schema.primKey,y=!!H.keyPath,f=e.numRowsPerChunk||Ro,P=y?{tableName:j.name,inbound:!0,rows:[]}:{tableName:j.name,inbound:!1,rows:[]},E=JSON.stringify(P,void 0,h?2:void 0),h&&(E=E.split(`
`).join(`
    `)),Z=E.lastIndexOf("]"),s.push(E.substring(0,Z)),q=null,se=0,pe=!0,ce=function(){var ye,xe,Je,it,ne,C,Ee,Ye,k,C;return lt(this,function(I){switch(I.label){case 0:return l&&Be.ignoreTransaction(function(){return l(p)}),ye=q==null?j.limit(f):j.where(":id").above(q).limit(f),[4,ye.toArray()];case 1:return xe=I.sent(),xe.length===0?[2,"break"]:(q!=null&&se>0&&(s.push(","),h&&s.push(`
      `)),pe=xe.length===f,y?(Je=w?xe.filter(function(B){return w(K,B)}):xe,it=x?Je.map(function(B){return x(K,B).value}):Je,ne=it.map(function(B){return rt.encapsulate(B)}),rt.mustFinalize()?[4,Be.waitFor(rt.finalize(ne))]:[3,3]):[3,4]);case 2:I.sent(),I.label=3;case 3:return C=JSON.stringify(ne,void 0,h?2:void 0),h&&(C=C.split(`
`).join(`
      `)),s.push(new Blob([C.substring(1,C.length-1)])),se=it.length,q=xe.length>0?Be.getByKeyPath(xe[xe.length-1],H.keyPath):null,[3,8];case 4:return[4,ye.primaryKeys()];case 5:return Ee=I.sent(),Ye=Ee.map(function(B,U){return[B,xe[U]]}),w&&(Ye=Ye.filter(function(B){var U=B[0],ie=B[1];return w(K,ie,U)})),x&&(Ye=Ye.map(function(B){var U=B[0],ie=B[1],le=x(K,ie,U);return[le.key,le.value]})),k=Ye.map(function(B){return rt.encapsulate(B)}),rt.mustFinalize()?[4,Be.waitFor(rt.finalize(k))]:[3,7];case 6:I.sent(),I.label=7;case 7:C=JSON.stringify(k,void 0,h?2:void 0),h&&(C=C.split(`
`).join(`
      `)),s.push(new Blob([C.substring(1,C.length-1)])),se=Ye.length,q=Ee.length>0?Ee[Ee.length-1]:null,I.label=8;case 8:return p.completedRows+=xe.length,[2]}})},Ne.label=1;case 1:return pe?[5,ce()]:[3,3];case 2:return Pe=Ne.sent(),Pe==="break"?[3,3]:[3,1];case 3:return s.push(E.substr(Z)),p.completedTables+=1,p.completedTables<p.totalTables&&s.push(","),[2]}})},_=0,S=o,N.label=2;case 2:return _<S.length?(R=S[_].name,[5,A(R)]):[3,5];case 3:N.sent(),N.label=4;case 4:return _++,[3,2];case 5:return s.push(g.substr(O)),p.done=!0,l&&Be.ignoreTransaction(function(){return l(p)}),[2]}})})}var r,i,s,o,h,d,l,p;return lt(this,function(m){switch(m.label){case 0:e=e||{},r=e.skipTables?e.skipTables:[],i=t.tables.filter(function(g){return!r.includes(g.name)}),s=[],o=i.map(function(g){return{name:g.name,schema:No(g),rowCount:0}}),h=e.prettyJson,d={formatName:"dexie",formatVersion:1,data:{databaseName:t.name,databaseVersion:t.verno,tables:o,data:[]}},l=e.progressCallback,p={done:!1,completedRows:0,completedTables:0,totalRows:NaN,totalTables:o.length},m.label=1;case 1:return m.trys.push([1,,6,7]),e.noTransaction?[4,n()]:[3,3];case 2:return m.sent(),[3,5];case 3:return[4,t.transaction("r",t.tables,n)];case 4:m.sent(),m.label=5;case 5:return[3,7];case 6:return rt.finalize(),[7];case 7:return[2,new Blob(s,{type:"text/json"})]}})})}var Fo=1,Uo={Stream:function(){}},Lo=Lr(function(t,e){(function(n){var r=typeof process=="object"&&Zr?Zr:self;n.parser=function(y){return new O(y)},n.CParser=O,n.CStream=w,n.createStream=T,n.MAX_BUFFER_LENGTH=10*1024*1024,n.DEBUG=r.CDEBUG==="debug",n.INFO=r.CDEBUG==="debug"||r.CDEBUG==="info",n.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var i={textNode:void 0,numberNode:""},s=n.EVENTS.filter(function(y){return y!=="error"&&y!=="end"}),o=0,h;n.STATE={BEGIN:o++,VALUE:o++,OPEN_OBJECT:o++,CLOSE_OBJECT:o++,OPEN_ARRAY:o++,CLOSE_ARRAY:o++,TEXT_ESCAPE:o++,STRING:o++,BACKSLASH:o++,END:o++,OPEN_KEY:o++,CLOSE_KEY:o++,TRUE:o++,TRUE2:o++,TRUE3:o++,FALSE:o++,FALSE2:o++,FALSE3:o++,FALSE4:o++,NULL:o++,NULL2:o++,NULL3:o++,NUMBER_DECIMAL_POINT:o++,NUMBER_DIGIT:o++};for(var d in n.STATE)n.STATE[n.STATE[d]]=d;o=n.STATE;const l={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125};Object.create||(Object.create=function(y){function f(){this.__proto__=y}return f.prototype=y,new f}),Object.getPrototypeOf||(Object.getPrototypeOf=function(y){return y.__proto__}),Object.keys||(Object.keys=function(y){var f=[];for(var P in y)y.hasOwnProperty(P)&&f.push(P);return f});function p(y){var f=Math.max(n.MAX_BUFFER_LENGTH,10),P=0;for(var E in i){var Z=y[E]===void 0?0:y[E].length;if(Z>f)switch(E){case"text":closeText(y);break;default:N(y,"Max buffer length exceeded: "+E)}P=Math.max(P,Z)}y.bufferCheckPosition=n.MAX_BUFFER_LENGTH-P+y.position}function m(y){for(var f in i)y[f]=i[f]}var g=/[\\"\n]/g;function O(y){if(!(this instanceof O))return new O(y);var f=this;m(f),f.bufferCheckPosition=n.MAX_BUFFER_LENGTH,f.q=f.c=f.p="",f.opt=y||{},f.closed=f.closedRoot=f.sawRoot=!1,f.tag=f.error=null,f.state=o.BEGIN,f.stack=new Array,f.position=f.column=0,f.line=1,f.slashed=!1,f.unicodeI=0,f.unicodeS=null,f.depth=0,x(f,"onready")}O.prototype={end:function(){K(this)},write:H,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{h=Uo.Stream}catch{h=function(){}}function T(y){return new w(y)}function w(y){if(!(this instanceof w))return new w(y);this._parser=new O(y),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var f=this;h.apply(f),this._parser.onend=function(){f.emit("end")},this._parser.onerror=function(P){f.emit("error",P),f._parser.error=null},s.forEach(function(P){Object.defineProperty(f,"on"+P,{get:function(){return f._parser["on"+P]},set:function(E){if(!E)return f.removeAllListeners(P),f._parser["on"+P]=E,E;f.on(P,E)},enumerable:!0,configurable:!1})})}w.prototype=Object.create(h.prototype,{constructor:{value:w}}),w.prototype.write=function(y){y=new Buffer(y);for(var f=0;f<y.length;f++){var P=y[f];if(this.bytes_remaining>0){for(var E=0;E<this.bytes_remaining;E++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+E]=y[E];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,f=f+E-1,this._parser.write(this.string),this.emit("data",this.string);continue}if(this.bytes_remaining===0&&P>=128)if(P>=194&&P<=223&&(this.bytes_in_sequence=2),P>=224&&P<=239&&(this.bytes_in_sequence=3),P>=240&&P<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+f>y.length){for(var Z=0;Z<=y.length-1-f;Z++)this.temp_buffs[this.bytes_in_sequence][Z]=y[f+Z];return this.bytes_remaining=f+this.bytes_in_sequence-y.length,!0}else{this.string=y.slice(f,f+this.bytes_in_sequence).toString(),f=f+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string);continue}for(var q=f;q<y.length&&!(y[q]>=128);q++);this.string=y.slice(f,q).toString(),this._parser.write(this.string),this.emit("data",this.string),f=q-1}},w.prototype.end=function(y){return y&&y.length&&this._parser.write(y.toString()),this._parser.end(),!0},w.prototype.on=function(y,f){var P=this;return!P._parser["on"+y]&&s.indexOf(y)!==-1&&(P._parser["on"+y]=function(){var E=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);E.splice(0,0,y),P.emit.apply(P,E)}),h.prototype.on.call(P,y,f)},w.prototype.destroy=function(){m(this._parser),this.emit("close")};function x(y,f,P){n.INFO&&console.log("-- emit",f,P),y[f]&&y[f](P)}function A(y,f,P){_(y),x(y,f,P)}function _(y,f){y.textNode=R(y.opt,y.textNode),y.textNode!==void 0&&x(y,f||"onvalue",y.textNode),y.textNode=void 0}function S(y){y.numberNode&&x(y,"onvalue",parseFloat(y.numberNode)),y.numberNode=""}function R(y,f){return f===void 0||(y.trim&&(f=f.trim()),y.normalize&&(f=f.replace(/\s+/g," "))),f}function N(y,f){return _(y),f+=`
Line: `+y.line+`
Column: `+y.column+`
Char: `+y.c,f=new Error(f),y.error=f,x(y,"onerror",f),y}function K(y){return(y.state!==o.VALUE||y.depth!==0)&&N(y,"Unexpected end"),_(y),y.c="",y.closed=!0,x(y,"onend"),O.call(y,y.opt),y}function j(y){return y===l.carriageReturn||y===l.lineFeed||y===l.space||y===l.tab}function H(y){var f=this;if(this.error)throw this.error;if(f.closed)return N(f,"Cannot write after close. Assign an onready handler.");if(y===null)return K(f);var P=0,E=y.charCodeAt(0),Z=f.p;for(n.DEBUG&&console.log("write -> ["+y+"]");E&&(Z=E,f.c=E=y.charCodeAt(P++),Z!==E?f.p=Z:Z=f.p,!!E);)switch(n.DEBUG&&console.log(P,E,n.STATE[f.state]),f.position++,E===l.lineFeed?(f.line++,f.column=0):f.column++,f.state){case o.BEGIN:E===l.openBrace?f.state=o.OPEN_OBJECT:E===l.openBracket?f.state=o.OPEN_ARRAY:j(E)||N(f,"Non-whitespace before {[.");continue;case o.OPEN_KEY:case o.OPEN_OBJECT:if(j(E))continue;if(f.state===o.OPEN_KEY)f.stack.push(o.CLOSE_KEY);else if(E===l.closeBrace){x(f,"onopenobject"),this.depth++,x(f,"oncloseobject"),this.depth--,f.state=f.stack.pop()||o.VALUE;continue}else f.stack.push(o.CLOSE_OBJECT);E===l.doubleQuote?f.state=o.STRING:N(f,'Malformed object key should start with "');continue;case o.CLOSE_KEY:case o.CLOSE_OBJECT:if(j(E))continue;f.state,o.CLOSE_KEY,E===l.colon?(f.state===o.CLOSE_OBJECT?(f.stack.push(o.CLOSE_OBJECT),_(f,"onopenobject"),this.depth++):_(f,"onkey"),f.state=o.VALUE):E===l.closeBrace?(A(f,"oncloseobject"),this.depth--,f.state=f.stack.pop()||o.VALUE):E===l.comma?(f.state===o.CLOSE_OBJECT&&f.stack.push(o.CLOSE_OBJECT),_(f),f.state=o.OPEN_KEY):N(f,"Bad object");continue;case o.OPEN_ARRAY:case o.VALUE:if(j(E))continue;if(f.state===o.OPEN_ARRAY)if(x(f,"onopenarray"),this.depth++,f.state=o.VALUE,E===l.closeBracket){x(f,"onclosearray"),this.depth--,f.state=f.stack.pop()||o.VALUE;continue}else f.stack.push(o.CLOSE_ARRAY);E===l.doubleQuote?f.state=o.STRING:E===l.openBrace?f.state=o.OPEN_OBJECT:E===l.openBracket?f.state=o.OPEN_ARRAY:E===l.t?f.state=o.TRUE:E===l.f?f.state=o.FALSE:E===l.n?f.state=o.NULL:E===l.minus?f.numberNode+="-":l._0<=E&&E<=l._9?(f.numberNode+=String.fromCharCode(E),f.state=o.NUMBER_DIGIT):N(f,"Bad value");continue;case o.CLOSE_ARRAY:if(E===l.comma)f.stack.push(o.CLOSE_ARRAY),_(f,"onvalue"),f.state=o.VALUE;else if(E===l.closeBracket)A(f,"onclosearray"),this.depth--,f.state=f.stack.pop()||o.VALUE;else{if(j(E))continue;N(f,"Bad array")}continue;case o.STRING:f.textNode===void 0&&(f.textNode="");var q=P-1,se=f.slashed,pe=f.unicodeI;e:for(;;){for(n.DEBUG&&console.log(P,E,n.STATE[f.state],se);pe>0;)if(f.unicodeS+=String.fromCharCode(E),E=y.charCodeAt(P++),f.position++,pe===4?(f.textNode+=String.fromCharCode(parseInt(f.unicodeS,16)),pe=0,q=P-1):pe++,!E)break e;if(E===l.doubleQuote&&!se){f.state=f.stack.pop()||o.VALUE,f.textNode+=y.substring(q,P-1),f.position+=P-1-q;break}if(E===l.backslash&&!se&&(se=!0,f.textNode+=y.substring(q,P-1),f.position+=P-1-q,E=y.charCodeAt(P++),f.position++,!E))break;if(se){if(se=!1,E===l.n?f.textNode+=`
`:E===l.r?f.textNode+="\r":E===l.t?f.textNode+="	":E===l.f?f.textNode+="\f":E===l.b?f.textNode+="\b":E===l.u?(pe=1,f.unicodeS=""):f.textNode+=String.fromCharCode(E),E=y.charCodeAt(P++),f.position++,q=P-1,E)continue;break}g.lastIndex=P;var ce=g.exec(y);if(ce===null){P=y.length+1,f.textNode+=y.substring(q,P-1),f.position+=P-1-q;break}if(P=ce.index+1,E=y.charCodeAt(ce.index),!E){f.textNode+=y.substring(q,P-1),f.position+=P-1-q;break}}f.slashed=se,f.unicodeI=pe;continue;case o.TRUE:E===l.r?f.state=o.TRUE2:N(f,"Invalid true started with t"+E);continue;case o.TRUE2:E===l.u?f.state=o.TRUE3:N(f,"Invalid true started with tr"+E);continue;case o.TRUE3:E===l.e?(x(f,"onvalue",!0),f.state=f.stack.pop()||o.VALUE):N(f,"Invalid true started with tru"+E);continue;case o.FALSE:E===l.a?f.state=o.FALSE2:N(f,"Invalid false started with f"+E);continue;case o.FALSE2:E===l.l?f.state=o.FALSE3:N(f,"Invalid false started with fa"+E);continue;case o.FALSE3:E===l.s?f.state=o.FALSE4:N(f,"Invalid false started with fal"+E);continue;case o.FALSE4:E===l.e?(x(f,"onvalue",!1),f.state=f.stack.pop()||o.VALUE):N(f,"Invalid false started with fals"+E);continue;case o.NULL:E===l.u?f.state=o.NULL2:N(f,"Invalid null started with n"+E);continue;case o.NULL2:E===l.l?f.state=o.NULL3:N(f,"Invalid null started with nu"+E);continue;case o.NULL3:E===l.l?(x(f,"onvalue",null),f.state=f.stack.pop()||o.VALUE):N(f,"Invalid null started with nul"+E);continue;case o.NUMBER_DECIMAL_POINT:E===l.period?(f.numberNode+=".",f.state=o.NUMBER_DIGIT):N(f,"Leading zero not followed by .");continue;case o.NUMBER_DIGIT:l._0<=E&&E<=l._9?f.numberNode+=String.fromCharCode(E):E===l.period?(f.numberNode.indexOf(".")!==-1&&N(f,"Invalid number has two dots"),f.numberNode+="."):E===l.e||E===l.E?((f.numberNode.indexOf("e")!==-1||f.numberNode.indexOf("E")!==-1)&&N(f,"Invalid number has two exponential"),f.numberNode+="e"):E===l.plus||E===l.minus?(Z===l.e||Z===l.E||N(f,"Invalid symbol in number"),f.numberNode+=String.fromCharCode(E)):(S(f),P--,f.state=f.stack.pop()||o.VALUE);continue;default:N(f,"Unknown state: "+f.state)}return f.position>=f.bufferCheckPosition&&p(f),f}})(e)});function Mo(t){var e=0,n=$o(!0),r={pullAsync:function(i){return Nt(this,void 0,void 0,function(){var s,o,h;return lt(this,function(d){switch(d.label){case 0:return s=t.slice(e,e+i),e+=i,[4,Ci(s,"text")];case 1:return o=d.sent(),h=n.write(o),r.result=h||{},[2,h]}})})},pullSync:function(i){var s=t.slice(e,e+i);e+=i;var o=ji(s,"text"),h=n.write(o);return r.result=h||{},h},done:function(){return n.done()},eof:function(){return e>=t.size},result:{}};return r}function $o(t){var e=Lo.parser(),n=0,r,i=[],s,o,h=!1,d=!1;return e.onopenobject=function(l){var p={};p.incomplete=!0,r||(r=p),s&&(i.push([o,s,d]),t&&(d?s.push(p):s[o]=p)),s=p,o=l,d=!1,++n},e.onkey=function(l){return o=l},e.onvalue=function(l){return d?s.push(l):s[o]=l},e.oncloseobject=function(){var l;if(delete s.incomplete,o=null,--n===0)h=!0;else{var p=s;l=i.pop(),o=l[0],s=l[1],d=l[2],t||(d?s.push(p):s[o]=p)}},e.onopenarray=function(){var l=[];l.incomplete=!0,r||(r=l),s&&(i.push([o,s,d]),t&&(d?s.push(l):s[o]=l)),s=l,d=!0,o=null,++n},e.onclosearray=function(){var l;if(delete s.incomplete,o=null,--n===0)h=!0;else{var p=s;l=i.pop(),o=l[0],s=l[1],d=l[2],t||(d?s.push(p):s[o]=p)}},{write:function(l){return e.write(l),r},done:function(){return h}}}var Ki=1024;function qo(t,e){return Nt(this,void 0,void 0,function(){var n,r,i,s;return lt(this,function(o){switch(o.label){case 0:return e=e||{},n=e.chunkSizeBytes||Ki*1024,[4,Di(t,n)];case 1:return r=o.sent(),i=r.result.data,s=new Be(i.databaseName),s.version(i.databaseVersion).stores(Co(i)),[4,Ri(s,r,e)];case 2:return o.sent(),[2,s]}})})}function Ri(t,e,n){return Nt(this,void 0,void 0,function(){function r(){return Nt(this,void 0,void 0,function(){var w,x,A,_,S;return lt(this,function(R){switch(R.label){case 0:w=function(N){var K,j,H,y,f,P,E,Z,q,se,pe,ce,Pe;return lt(this,function(Ne){switch(Ne.label){case 0:if(l.includes(N.tableName))return[2,"continue"];if(!N.rows)return[2,"break"];if(!N.rows.incomplete&&N.rows.length===0)return[2,"continue"];if(p&&Be.ignoreTransaction(function(){return p(m)}),K=N.tableName,j=t.table(K),H=d.tables.filter(function(ye){return ye.name===K})[0].schema,!j){if(n.acceptMissingTables)return[2,"continue"];throw new Error("Exported table ".concat(N.tableName," is missing in installed database"))}if(!n.acceptChangedPrimaryKey&&H.split(",")[0]!=j.schema.primKey.src)throw new Error("Primary key differs for table ".concat(N.tableName,". "));for(y=N.rows,f=[],P=0;P<y.length&&(E=y[P],!E.incomplete);P++)f.push(rt.revive(E));return Z=n.filter,q=n.transform,se=Z?N.inbound?f.filter(function(ye){return Z(K,ye)}):f.filter(function(ye){var xe=ye[0],Je=ye[1];return Z(K,Je,xe)}):f,q&&(se=se.map(N.inbound?function(ye){return q(K,ye).value}:function(ye){var xe=ye[0],Je=ye[1],it=q(K,Je,xe);return[it.key,it.value]})),pe=N.inbound?[void 0,se]:[se.map(function(ye){return ye[0]}),f.map(function(ye){return ye[1]})],ce=pe[0],Pe=pe[1],n.overwriteValues?[4,j.bulkPut(Pe,ce)]:[3,2];case 1:return Ne.sent(),[3,4];case 2:return[4,j.bulkAdd(Pe,ce)];case 3:Ne.sent(),Ne.label=4;case 4:return m.completedRows+=f.length,f.incomplete||(m.completedTables+=1),y.splice(0,f.length),[2]}})},x=0,A=d.data,R.label=1;case 1:return x<A.length?(_=A[x],[5,w(_)]):[3,4];case 2:if(S=R.sent(),S==="break")return[3,4];R.label=3;case 3:return x++,[3,1];case 4:for(;d.data.length>0&&d.data[0].rows&&!d.data[0].rows.incomplete;)d.data.splice(0,1);return!s.done()&&!s.eof()?h?(s.pullSync(i),[3,7]):[3,5]:[3,8];case 5:return[4,Be.waitFor(s.pullAsync(i))];case 6:R.sent(),R.label=7;case 7:return[3,9];case 8:return[3,10];case 9:return[3,0];case 10:return[2]}})})}var i,s,o,h,d,l,p,m,g,O,T;return lt(this,function(w){switch(w.label){case 0:return n=n||{},i=n.chunkSizeBytes||Ki*1024,[4,Di(e,i)];case 1:if(s=w.sent(),o=s.result,h="FileReaderSync"in self,d=o.data,l=n.skipTables?n.skipTables:[],!n.acceptNameDiff&&t.name!==d.databaseName)throw new Error("Name differs. Current database name is ".concat(t.name," but export is ").concat(d.databaseName));if(!n.acceptVersionDiff&&t.verno!==d.databaseVersion)throw new Error("Database version differs. Current database is in version ".concat(t.verno," but export is ").concat(d.databaseVersion));if(p=n.progressCallback,m={done:!1,completedRows:0,completedTables:0,totalRows:d.tables.reduce(function(x,A){return x+A.rowCount},0),totalTables:d.tables.length},p&&Be.ignoreTransaction(function(){return p(m)}),!n.clearTablesBeforeImport)return[3,5];g=0,O=t.tables,w.label=2;case 2:return g<O.length?(T=O[g],l.includes(T.name)?[3,4]:[4,T.clear()]):[3,5];case 3:w.sent(),w.label=4;case 4:return g++,[3,2];case 5:return n.noTransaction?[4,r()]:[3,7];case 6:return w.sent(),[3,9];case 7:return[4,t.transaction("rw",t.tables,r)];case 8:w.sent(),w.label=9;case 9:return m.done=!0,p&&Be.ignoreTransaction(function(){return p(m)}),[2]}})})}function Di(t,e){return Nt(this,void 0,void 0,function(){var n,r;return lt(this,function(i){switch(i.label){case 0:n="slice"in t?Mo(t):t,i.label=1;case 1:return n.eof()?[3,3]:[4,n.pullAsync(e)];case 2:return i.sent(),n.result.data&&n.result.data.data?[3,3]:[3,1];case 3:if(r=n.result,!r||r.formatName!="dexie")throw new Error("Given file is not a dexie export");if(r.formatVersion>Fo)throw new Error("Format version ".concat(r.formatVersion," not supported"));if(!r.data)throw new Error("No data in export file");if(!r.data.databaseName)throw new Error("Missing databaseName in export file");if(!r.data.databaseVersion)throw new Error("Missing databaseVersion in export file");if(!r.data.tables)throw new Error("Missing tables in export file");return[2,n]}})})}Be.prototype.export=function(t){return Do(this,t)};Be.prototype.import=function(t,e){return Ri(this,t,e)};Be.import=function(t,e){return qo(t,e)};export{Be as X,Do as e};
